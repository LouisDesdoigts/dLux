
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for dLux.">
      
      
        <meta name="author" content="Louis Desdoigts">
      
      
        <link rel="canonical" href="https://louisdesdoigts.github.io/dlux/docs/API/optics/">
      
      
        <link rel="prev" href="../wavefronts/">
      
      
        <link rel="next" href="../optical_layers/">
      
      <link rel="icon" href="../../../material/telescope">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.15">
    
    
      
        <title>Optics - dLux</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.26e3688c.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="amber">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#optical-systems-opticspy" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="dLux" class="md-header__button md-logo" aria-label="dLux" data-md-component="logo">
      
  <img src="../../../assets/logo.jpg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            dLux
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Optics
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="amber"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="amber"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/LouisDesdoigts/dlux" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    louisdesdoigts/dlux
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="dLux" class="md-nav__button md-logo" aria-label="dLux" data-md-component="logo">
      
  <img src="../../../assets/logo.jpg" alt="logo">

    </a>
    dLux
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/LouisDesdoigts/dlux" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    louisdesdoigts/dlux
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Tutorials
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/" class="md-nav__link">
        Usage
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../notebooks/phase_retrieval_demo/" class="md-nav__link">
        Phase Retrieval in dLux
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../notebooks/designing_a_mask/" class="md-nav__link">
        Phase Mask Design
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../notebooks/flatfield_calibration/" class="md-nav__link">
        Pixel Level Calibration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../notebooks/fisher_information/" class="md-nav__link">
        Fisher Information
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../notebooks/HMC/" class="md-nav__link">
        Numpyro and Hamiltonian Monte Carlo
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          dLux API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          dLux API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../wavefronts/" class="md-nav__link">
        Wavefronts
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Optics
      </a>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../optical_layers/" class="md-nav__link">
        Optical Layers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../propagators/" class="md-nav__link">
        Propagators
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../apertures/" class="md-nav__link">
        Apertures
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../aberrations/" class="md-nav__link">
        Aberrations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../spectra/" class="md-nav__link">
        Spectra
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sources/" class="md-nav__link">
        Sources
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../images/" class="md-nav__link">
        Images
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../detector_layers/" class="md-nav__link">
        Detector Layers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../detectors/" class="md-nav__link">
        Detectors
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../instruments/" class="md-nav__link">
        Instruments
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../observations/" class="md-nav__link">
        Observations
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Utils API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Utils API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utils/optics/" class="md-nav__link">
        Optics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utils/units/" class="md-nav__link">
        Units
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utils/math/" class="md-nav__link">
        Math
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utils/coordinates/" class="md-nav__link">
        Coordinates
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utils/interpolation/" class="md-nav__link">
        Interpolation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utils/helpers/" class="md-nav__link">
        Helpers
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../faq/" class="md-nav__link">
        FAQ & Troubleshooting
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../CHANGELOG/" class="md-nav__link">
        Change Log
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../CONTRIBUTING/" class="md-nav__link">
        Contributing
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="optical-systems-opticspy">Optical Systems: optics.py<a class="headerlink" href="#optical-systems-opticspy" title="Permanent link">¤</a></h1>
<p>This module contains the classes that define the behaviour of optical systems in dLux. The classes are designed to be as flexible as possible, allowing users to easily create their own optical systems.</p>
<p>There are four public classes:</p>
<ul>
<li><code>AngularOptics</code></li>
<li><code>CartesianOptics</code></li>
<li><code>FlexibleOptics</code></li>
<li><code>LayeredOptics</code></li>
</ul>
<p>Optics classes store <code>OpticalLayers</code> that operatre on <code>Wavefronts</code>.</p>
<p>There are two types of optics classes, Layered and non-Layered. Layered optics classes take in a list of <code>OpticalLayers</code> and apply them sequentially to the wavefront, giving users full control and flexibilty in the modelling of their optical system.</p>
<p>Non-Layered optics classes are designed to be simple and easy to use, taking in a few parameters that define the behaviour of common optical system. We will explore these mode in the Examples section.</p>
<p>All public optics classes have 3 main methods:</p>
<ol>
<li><code>model(sources)</code> Models dLux Source objects through the optics.</li>
<li><code>propagate(wavelengths, offset, weights)</code> Models a polychromatic point source through the optics.</li>
<li><code>propagate_mono(wavelength, offset)</code> Propagates a monochromatic point source through the optics.</li>
</ol>
<p>The <code>propagate_mono(wavelength, offset)</code> method is where the actual propagation of the wavefront through the optics occurs, but the <code>.propagate</code> vectorises the calcluations across wavelengths for efficiency.</p>
<hr />
<h1 id="examples">Examples<a class="headerlink" href="#examples" title="Permanent link">¤</a></h1>
<p>We will start here with the non-layered optics classes as they are simpler than
the LayeredOptics class.</p>
<h2 id="angularoptics">AngularOptics<a class="headerlink" href="#angularoptics" title="Permanent link">¤</a></h2>
<details class="info">
<summary>Angular Optics API</summary>
<div class="mkdocstrings">

<div class="doc doc-object doc-class">


<a id="dLux.optics.AngularOptics"></a>
  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code><span title="dLux.optics.NonPropagatorOptics">NonPropagatorOptics</span></code>, <code><span title="dLux.optics.AperturedOptics">AperturedOptics</span></code>, <code><span title="dLux.optics.SimpleOptics">SimpleOptics</span></code></p>

  
      <p>A simple optical system that propagates a wavefront to an image plane
with <code>psf_pixel_scale</code> in units of arcseconds.</p>

  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>wf_npixels</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The number of pixels representing the wavefront.</p></td>
        </tr>
        <tr>
          <td><code>diameter</code></td>
          <td>
                <code><span title="jax.Array">Array</span>, meters</code>
          </td>
          <td><p>The diameter of the initial wavefront to propagte.</p></td>
        </tr>
        <tr>
          <td><code>aperture</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="jax.Array">Array</span>, <span title="dLux.optics.OpticalLayer">OpticalLayer</span>]</code>
          </td>
          <td><p>The aperture of the system. Can be an Array or a OpticalLayer.</p></td>
        </tr>
        <tr>
          <td><code>mask</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="jax.Array">Array</span>, <span title="dLux.optics.OpticalLayer">OpticalLayer</span>]</code>
          </td>
          <td><p>The mask to apply to the wavefront. Can be an Array or an OpticalLayer.
If an Array it is treated as a transmissive mask.</p></td>
        </tr>
        <tr>
          <td><code>psf_pixel_scale</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>The pixel scale of the final PSF.</p></td>
        </tr>
        <tr>
          <td><code>psf_oversample</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>The oversampling factor of the final PSF.</p></td>
        </tr>
        <tr>
          <td><code>psf_npixels</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The number of pixels of the final PSF.</p></td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>dLux/optics.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">AngularOptics</span><span class="p">(</span><span class="n">NonPropagatorOptics</span><span class="p">,</span> <span class="n">AperturedOptics</span><span class="p">,</span> <span class="n">SimpleOptics</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A simple optical system that propagates a wavefront to an image plane</span>
<span class="sd">    with `psf_pixel_scale` in units of arcseconds.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    wf_npixels : int</span>
<span class="sd">        The number of pixels representing the wavefront.</span>
<span class="sd">    diameter : Array, meters</span>
<span class="sd">        The diameter of the initial wavefront to propagte.</span>
<span class="sd">    aperture : Union[Array, OpticalLayer]</span>
<span class="sd">        The aperture of the system. Can be an Array or a OpticalLayer.</span>
<span class="sd">    mask : Union[Array, OpticalLayer]</span>
<span class="sd">        The mask to apply to the wavefront. Can be an Array or an OpticalLayer.</span>
<span class="sd">        If an Array it is treated as a transmissive mask.</span>
<span class="sd">    psf_pixel_scale : float</span>
<span class="sd">        The pixel scale of the final PSF.</span>
<span class="sd">    psf_oversample : float</span>
<span class="sd">        The oversampling factor of the final PSF.</span>
<span class="sd">    psf_npixels : int</span>
<span class="sd">        The number of pixels of the final PSF.</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span>            <span class="p">:</span> <span class="n">AngularOptics</span><span class="p">,</span> 
                 <span class="n">wf_npixels</span>      <span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                 <span class="n">diameter</span>        <span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                 <span class="n">aperture</span>        <span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Array</span><span class="p">,</span> <span class="n">OpticalLayer</span><span class="p">()],</span>
                 <span class="n">psf_npixels</span>     <span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                 <span class="n">psf_pixel_scale</span> <span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                 <span class="n">psf_oversample</span>  <span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                 <span class="n">mask</span>            <span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Array</span><span class="p">,</span> <span class="n">OpticalLayer</span><span class="p">()]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        wf_npixels : int</span>
<span class="sd">            The number of pixels representing the wavefront.</span>
<span class="sd">        diameter : Array, meters</span>
<span class="sd">            The diameter of the initial wavefront to propagte.</span>
<span class="sd">        aperture : Union[Array, OpticalLayer]</span>
<span class="sd">            The aperture of the system. Can be an Array or a OpticalLayer.</span>
<span class="sd">        psf_npixels : int</span>
<span class="sd">            The number of pixels of the final PSF.</span>
<span class="sd">        psf_pixel_scale : float, arcseconds</span>
<span class="sd">            The pixel scale of the final PSF in units of arcseconds.</span>
<span class="sd">        psf_oversample : float</span>
<span class="sd">            The oversampling factor of the final PSF.</span>
<span class="sd">        mask : Union[Array, OpticalLayer] = None</span>
<span class="sd">            The mask to apply to the wavefront. Can be an Array or an</span>
<span class="sd">            OpticalLayer. If an Array it is treated as a transmissive mask.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">wf_npixels</span><span class="o">=</span><span class="n">wf_npixels</span><span class="p">,</span> <span class="n">diameter</span><span class="o">=</span><span class="n">diameter</span><span class="p">,</span> 
            <span class="n">aperture</span><span class="o">=</span><span class="n">aperture</span><span class="p">,</span> <span class="n">psf_npixels</span><span class="o">=</span><span class="n">psf_npixels</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span>
            <span class="n">psf_pixel_scale</span><span class="o">=</span><span class="n">psf_pixel_scale</span><span class="p">,</span> <span class="n">psf_oversample</span><span class="o">=</span><span class="n">psf_oversample</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">propagate_mono</span><span class="p">(</span><span class="bp">self</span>       <span class="p">:</span> <span class="n">AngularOptics</span><span class="p">,</span>
                       <span class="n">wavelength</span> <span class="p">:</span> <span class="n">Array</span><span class="p">,</span>
                       <span class="n">offset</span>     <span class="p">:</span> <span class="n">Array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
                       <span class="n">return_wf</span>  <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Propagates a monochromatic point source through the optical layers.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        wavelength : Array, meters</span>
<span class="sd">            The wavelength of the wavefront to propagate through the optical</span>
<span class="sd">            layers.</span>
<span class="sd">        offset : Array, radians, = np.zeros(2)</span>
<span class="sd">            The (x, y) offset from the optical axis of the source. Default</span>
<span class="sd">            value is (0, 0), on axis.</span>
<span class="sd">        return_wf : bool, = False</span>
<span class="sd">            If True, the wavefront object after propagation is returned.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        psf : Array</span>
<span class="sd">            The monochromatic point spread function after being propagated</span>
<span class="sd">            though the optical layers.</span>
<span class="sd">        wavefront : Wavefront</span>
<span class="sd">            The wavefront object after propagation. Only returned if</span>
<span class="sd">            return_wf is True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">wf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_aperture</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>

        <span class="c1"># Propagate</span>
        <span class="n">pixel_scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">psf_pixel_scale</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">psf_oversample</span>
        <span class="n">pixel_scale_radians</span> <span class="o">=</span> <span class="n">dlu</span><span class="o">.</span><span class="n">arcsec_to_rad</span><span class="p">(</span><span class="n">pixel_scale</span><span class="p">)</span>
        <span class="n">wf</span> <span class="o">=</span> <span class="n">wf</span><span class="o">.</span><span class="n">MFT</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psf_npixels</span><span class="p">,</span> <span class="n">pixel_scale_radians</span><span class="p">)</span>

        <span class="c1"># Return PSF or Wavefront</span>
        <span class="k">if</span> <span class="n">return_wf</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">wf</span>
        <span class="k">return</span> <span class="n">wf</span><span class="o">.</span><span class="n">psf</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="dLux.optics.AngularOptics.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">wf_npixels</span><span class="p">,</span> <span class="n">diameter</span><span class="p">,</span> <span class="n">aperture</span><span class="p">,</span> <span class="n">psf_npixels</span><span class="p">,</span> <span class="n">psf_pixel_scale</span><span class="p">,</span> <span class="n">psf_oversample</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#dLux.optics.AngularOptics.__init__" class="headerlink" title="Permanent link">¤</a></h2>


  <div class="doc doc-contents ">
  

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>wf_npixels</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The number of pixels representing the wavefront.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>diameter</code></td>
          <td>
                <code><span title="jax.Array">Array</span>, meters</code>
          </td>
          <td><p>The diameter of the initial wavefront to propagte.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>aperture</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="jax.Array">Array</span>, <span title="dLux.optics.OpticalLayer">OpticalLayer</span>]</code>
          </td>
          <td><p>The aperture of the system. Can be an Array or a OpticalLayer.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>psf_npixels</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The number of pixels of the final PSF.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>psf_pixel_scale</code></td>
          <td>
                <code>float, arcseconds</code>
          </td>
          <td><p>The pixel scale of the final PSF in units of arcseconds.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>psf_oversample</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>The oversampling factor of the final PSF.</p></td>
          <td>
                <code>1</code>
          </td>
        </tr>
        <tr>
          <td><code>mask</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="jax.Array">Array</span>, <span title="dLux.optics.OpticalLayer">OpticalLayer</span>]</code>
          </td>
          <td><p>The mask to apply to the wavefront. Can be an Array or an
OpticalLayer. If an Array it is treated as a transmissive mask.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>dLux/optics.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span>            <span class="p">:</span> <span class="n">AngularOptics</span><span class="p">,</span> 
             <span class="n">wf_npixels</span>      <span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
             <span class="n">diameter</span>        <span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
             <span class="n">aperture</span>        <span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Array</span><span class="p">,</span> <span class="n">OpticalLayer</span><span class="p">()],</span>
             <span class="n">psf_npixels</span>     <span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
             <span class="n">psf_pixel_scale</span> <span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
             <span class="n">psf_oversample</span>  <span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">mask</span>            <span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Array</span><span class="p">,</span> <span class="n">OpticalLayer</span><span class="p">()]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    wf_npixels : int</span>
<span class="sd">        The number of pixels representing the wavefront.</span>
<span class="sd">    diameter : Array, meters</span>
<span class="sd">        The diameter of the initial wavefront to propagte.</span>
<span class="sd">    aperture : Union[Array, OpticalLayer]</span>
<span class="sd">        The aperture of the system. Can be an Array or a OpticalLayer.</span>
<span class="sd">    psf_npixels : int</span>
<span class="sd">        The number of pixels of the final PSF.</span>
<span class="sd">    psf_pixel_scale : float, arcseconds</span>
<span class="sd">        The pixel scale of the final PSF in units of arcseconds.</span>
<span class="sd">    psf_oversample : float</span>
<span class="sd">        The oversampling factor of the final PSF.</span>
<span class="sd">    mask : Union[Array, OpticalLayer] = None</span>
<span class="sd">        The mask to apply to the wavefront. Can be an Array or an</span>
<span class="sd">        OpticalLayer. If an Array it is treated as a transmissive mask.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">wf_npixels</span><span class="o">=</span><span class="n">wf_npixels</span><span class="p">,</span> <span class="n">diameter</span><span class="o">=</span><span class="n">diameter</span><span class="p">,</span> 
        <span class="n">aperture</span><span class="o">=</span><span class="n">aperture</span><span class="p">,</span> <span class="n">psf_npixels</span><span class="o">=</span><span class="n">psf_npixels</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span>
        <span class="n">psf_pixel_scale</span><span class="o">=</span><span class="n">psf_pixel_scale</span><span class="p">,</span> <span class="n">psf_oversample</span><span class="o">=</span><span class="n">psf_oversample</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="dLux.optics.AngularOptics.propagate_mono" class="doc doc-heading">
<code class="highlight language-python"><span class="n">propagate_mono</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">return_wf</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#dLux.optics.AngularOptics.propagate_mono" class="headerlink" title="Permanent link">¤</a></h2>


  <div class="doc doc-contents ">
  
      <p>Propagates a monochromatic point source through the optical layers.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>wavelength</code></td>
          <td>
                <code><span title="jax.Array">Array</span>, meters</code>
          </td>
          <td><p>The wavelength of the wavefront to propagate through the optical
layers.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>offset</code></td>
          <td>
                <code><span title="jax.Array">Array</span>, radians</code>
          </td>
          <td><p>The (x, y) offset from the optical axis of the source. Default
value is (0, 0), on axis.</p></td>
          <td>
                <code>np.zeros(2)</code>
          </td>
        </tr>
        <tr>
          <td><code>return_wf</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>If True, the wavefront object after propagation is returned.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>psf</code></td>          <td>
                <code><span title="jax.Array">Array</span></code>
          </td>
          <td><p>The monochromatic point spread function after being propagated
though the optical layers.</p></td>
        </tr>
        <tr>
<td><code>wavefront</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="dLux.wavefronts.Wavefront" href="../wavefronts/#dLux.wavefronts.Wavefront">Wavefront</a></code>
          </td>
          <td><p>The wavefront object after propagation. Only returned if
return_wf is True.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>dLux/optics.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">propagate_mono</span><span class="p">(</span><span class="bp">self</span>       <span class="p">:</span> <span class="n">AngularOptics</span><span class="p">,</span>
                   <span class="n">wavelength</span> <span class="p">:</span> <span class="n">Array</span><span class="p">,</span>
                   <span class="n">offset</span>     <span class="p">:</span> <span class="n">Array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
                   <span class="n">return_wf</span>  <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Propagates a monochromatic point source through the optical layers.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    wavelength : Array, meters</span>
<span class="sd">        The wavelength of the wavefront to propagate through the optical</span>
<span class="sd">        layers.</span>
<span class="sd">    offset : Array, radians, = np.zeros(2)</span>
<span class="sd">        The (x, y) offset from the optical axis of the source. Default</span>
<span class="sd">        value is (0, 0), on axis.</span>
<span class="sd">    return_wf : bool, = False</span>
<span class="sd">        If True, the wavefront object after propagation is returned.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    psf : Array</span>
<span class="sd">        The monochromatic point spread function after being propagated</span>
<span class="sd">        though the optical layers.</span>
<span class="sd">    wavefront : Wavefront</span>
<span class="sd">        The wavefront object after propagation. Only returned if</span>
<span class="sd">        return_wf is True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">wf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_aperture</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>

    <span class="c1"># Propagate</span>
    <span class="n">pixel_scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">psf_pixel_scale</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">psf_oversample</span>
    <span class="n">pixel_scale_radians</span> <span class="o">=</span> <span class="n">dlu</span><span class="o">.</span><span class="n">arcsec_to_rad</span><span class="p">(</span><span class="n">pixel_scale</span><span class="p">)</span>
    <span class="n">wf</span> <span class="o">=</span> <span class="n">wf</span><span class="o">.</span><span class="n">MFT</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psf_npixels</span><span class="p">,</span> <span class="n">pixel_scale_radians</span><span class="p">)</span>

    <span class="c1"># Return PSF or Wavefront</span>
    <span class="k">if</span> <span class="n">return_wf</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">wf</span>
    <span class="k">return</span> <span class="n">wf</span><span class="o">.</span><span class="n">psf</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h2 data-role="class" id="dLux.optics.AngularOptics"><a class="headerlink" href="#dLux.optics.AngularOptics" title="Permanent link">¤</a></h2>
<h2 class="doc doc-heading" data-role="function" id="dLux.optics.AngularOptics.__init__"><a class="headerlink" href="#dLux.optics.AngularOptics.__init__" title="Permanent link">¤</a></h2>
<h2 class="doc doc-heading" data-role="function" id="dLux.optics.AngularOptics.propagate_mono"><a class="headerlink" href="#dLux.optics.AngularOptics.propagate_mono" title="Permanent link">¤</a></h2>
</div>
</details>
<p>To construct a <code>AngularOptics</code> class we need to define 5 things:</p>
<ol>
<li>The number of pixels of the initial wavefront</li>
<li>The diameter of the initial wavefront</li>
<li>The aperture of the system</li>
<li>The number of pixels of the final PSF</li>
<li>The pixel scale of the final PSF</li>
</ol>
<div class="admonition tip">
<p class="admonition-title">Units</p>
<p>Most code in dLux is written in SI units, but this class breaks from this convention, with <code>psf_pixel_scale</code> taken in units of arcseconds typical of astronomical optical sysetms.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Apertures</p>
<p>The 'aperture' parameter can also be supplied as an array, where it will treated as a array of transmission values!</p>
</div>
<p>The following code snippet shows how to construct a simple optical system and
propagate a point source through it.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">jax.numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">dLux</span> <span class="k">as</span> <span class="nn">dl</span>

<span class="c1"># Define the parameters</span>
<span class="n">wf_npixels</span> <span class="o">=</span> <span class="mi">256</span>
<span class="n">diameter</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># meters</span>
<span class="n">psf_npixels</span> <span class="o">=</span> <span class="mi">128</span>
<span class="n">psf_pixel_scale</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="c1"># arcseconds</span>
<span class="n">psf_oversample</span> <span class="o">=</span> <span class="mi">4</span>

<span class="c1"># Use ApertureFactory class to make a simple circular aperture</span>
<span class="n">aperture</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">ApertureFactory</span><span class="p">(</span><span class="n">wf_npixels</span><span class="p">)</span>

<span class="c1"># Construct the optics class</span>
<span class="n">optics</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">AngularOptics</span><span class="p">(</span><span class="n">wf_npixels</span><span class="p">,</span> <span class="n">diameter</span><span class="p">,</span> <span class="n">aperture</span><span class="p">,</span> 
    <span class="n">psf_npixels</span><span class="p">,</span> <span class="n">psf_pixel_scale</span><span class="p">,</span> <span class="n">psf_oversample</span><span class="p">)</span>

<span class="c1"># Propagate the wavelengths</span>
<span class="n">wavelengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1.2e-6</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="c1"># meters</span>
<span class="n">psf</span> <span class="o">=</span> <span class="n">optics</span><span class="o">.</span><span class="n">propagate</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">)</span>
</code></pre></div>
<details class="abstract">
<summary>Plotting code</summary>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Aperture&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">optics</span><span class="o">.</span><span class="n">aperture</span><span class="o">.</span><span class="n">transmission</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;$\sqrt</span><span class="si">{PSF}</span><span class="s2">$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">psf</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;angular_psf.png&#39;</span><span class="p">)</span>
</code></pre></div>
</details>
<p><img alt="angular_psf" src="../../assets/angular_psf.png" /></p>
<hr />
<h2 id="cartesianoptics">CartesianOptics<a class="headerlink" href="#cartesianoptics" title="Permanent link">¤</a></h2>
<p>The <code>CartesianOptics</code> class is very similar to the <code>AngularOptics</code> class, but it also takes in a focal length, and the units of psf_pixel_scale is taken in microns.</p>
<details class="info">
<summary>Cartesian Optics API</summary>
<div class="mkdocstrings">

<div class="doc doc-object doc-class">


<a id="dLux.optics.CartesianOptics"></a>
  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code><span title="dLux.optics.NonPropagatorOptics">NonPropagatorOptics</span></code>, <code><span title="dLux.optics.AperturedOptics">AperturedOptics</span></code>, <code><span title="dLux.optics.SimpleOptics">SimpleOptics</span></code></p>

  
      <p>A simple optical system that propagates a wavefront to an image plane
with <code>psf_pixel_scale</code> in units of microns.</p>

  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>wf_npixels</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The number of pixels representing the wavefront.</p></td>
        </tr>
        <tr>
          <td><code>diameter</code></td>
          <td>
                <code><span title="jax.Array">Array</span>, meters</code>
          </td>
          <td><p>The diameter of the initial wavefront to propagte.</p></td>
        </tr>
        <tr>
          <td><code>focal_length</code></td>
          <td>
                <code>float, meters</code>
          </td>
          <td><p>The focal length of the optical system.</p></td>
        </tr>
        <tr>
          <td><code>aperture</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="jax.Array">Array</span>, <span title="dLux.optics.OpticalLayer">OpticalLayer</span>]</code>
          </td>
          <td><p>The aperture of the system. Can be an Array or a OpticalLayer.</p></td>
        </tr>
        <tr>
          <td><code>mask</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="jax.Array">Array</span>, <span title="dLux.optics.OpticalLayer">OpticalLayer</span>]</code>
          </td>
          <td><p>The mask to apply to the wavefront. Can be an Array or an OpticalLayer.
If an Array it is treated as a transmissive mask.</p></td>
        </tr>
        <tr>
          <td><code>psf_pixel_scale</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>The pixel scale of the final PSF.</p></td>
        </tr>
        <tr>
          <td><code>psf_oversample</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>The oversampling factor of the final PSF.</p></td>
        </tr>
        <tr>
          <td><code>psf_npixels</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The number of pixels of the final PSF.</p></td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>dLux/optics.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">CartesianOptics</span><span class="p">(</span><span class="n">NonPropagatorOptics</span><span class="p">,</span> <span class="n">AperturedOptics</span><span class="p">,</span> <span class="n">SimpleOptics</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A simple optical system that propagates a wavefront to an image plane</span>
<span class="sd">    with `psf_pixel_scale` in units of microns.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    wf_npixels : int</span>
<span class="sd">        The number of pixels representing the wavefront.</span>
<span class="sd">    diameter : Array, meters</span>
<span class="sd">        The diameter of the initial wavefront to propagte.</span>
<span class="sd">    focal_length : float, meters</span>
<span class="sd">        The focal length of the optical system.</span>
<span class="sd">    aperture : Union[Array, OpticalLayer]</span>
<span class="sd">        The aperture of the system. Can be an Array or a OpticalLayer.</span>
<span class="sd">    mask : Union[Array, OpticalLayer]</span>
<span class="sd">        The mask to apply to the wavefront. Can be an Array or an OpticalLayer.</span>
<span class="sd">        If an Array it is treated as a transmissive mask.</span>
<span class="sd">    psf_pixel_scale : float</span>
<span class="sd">        The pixel scale of the final PSF.</span>
<span class="sd">    psf_oversample : float</span>
<span class="sd">        The oversampling factor of the final PSF.</span>
<span class="sd">    psf_npixels : int</span>
<span class="sd">        The number of pixels of the final PSF.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">focal_length</span> <span class="p">:</span> <span class="kc">None</span>


    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span>            <span class="p">:</span> <span class="n">CartesianOptics</span><span class="p">,</span>
                 <span class="n">wf_npixels</span>      <span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                 <span class="n">diameter</span>        <span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                 <span class="n">aperture</span>        <span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Array</span><span class="p">,</span> <span class="n">OpticalLayer</span><span class="p">()],</span>
                 <span class="n">focal_length</span>    <span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                 <span class="n">psf_npixels</span>     <span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                 <span class="n">psf_pixel_scale</span> <span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                 <span class="n">psf_oversample</span>  <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                 <span class="n">mask</span>            <span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Array</span><span class="p">,</span> <span class="n">OpticalLayer</span><span class="p">()]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        wf_npixels : int</span>
<span class="sd">            The number of pixels representing the wavefront.</span>
<span class="sd">        diameter : Array, meters</span>
<span class="sd">            The diameter of the initial wavefront to propagte.</span>
<span class="sd">        aperture : Union[Array, OpticalLayer]</span>
<span class="sd">            The aperture of the system. Can be an Array or a OpticalLayer.</span>
<span class="sd">        focal_length : float, meters</span>
<span class="sd">            The focal length of the optical system.</span>
<span class="sd">        psf_npixels : int</span>
<span class="sd">            The number of pixels of the final PSF.</span>
<span class="sd">        psf_pixel_scale : float, microns</span>
<span class="sd">            The pixel scale of the final PSF in units of microns.</span>
<span class="sd">        psf_oversample : float</span>
<span class="sd">            The oversampling factor of the final PSF.</span>
<span class="sd">        mask : Union[Array, OpticalLayer] = None</span>
<span class="sd">            The mask to apply to the wavefront. Can be an Array or an</span>
<span class="sd">            OpticalLayer. If an Array it is treated as a transmissive mask.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">focal_length</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">focal_length</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">wf_npixels</span><span class="o">=</span><span class="n">wf_npixels</span><span class="p">,</span> <span class="n">diameter</span><span class="o">=</span><span class="n">diameter</span><span class="p">,</span>
            <span class="n">aperture</span><span class="o">=</span><span class="n">aperture</span><span class="p">,</span> <span class="n">psf_npixels</span><span class="o">=</span><span class="n">psf_npixels</span><span class="p">,</span>
            <span class="n">psf_pixel_scale</span><span class="o">=</span><span class="n">psf_pixel_scale</span><span class="p">,</span> <span class="n">psf_oversample</span><span class="o">=</span><span class="n">psf_oversample</span><span class="p">,</span>
            <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">propagate_mono</span><span class="p">(</span><span class="bp">self</span>       <span class="p">:</span> <span class="n">SimpleToliman</span><span class="p">,</span>
                       <span class="n">wavelength</span> <span class="p">:</span> <span class="n">Array</span><span class="p">,</span>
                       <span class="n">offset</span>     <span class="p">:</span> <span class="n">Array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
                       <span class="n">return_wf</span>  <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Propagates a monochromatic point source through the optical layers.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        wavelength : Array, meters</span>
<span class="sd">            The wavelength of the wavefront to propagate through the optical</span>
<span class="sd">            layers.</span>
<span class="sd">        offset : Array, radians, = np.zeros(2)</span>
<span class="sd">            The (x, y) offset from the optical axis of the source. Default</span>
<span class="sd">            value is (0, 0), on axis.</span>
<span class="sd">        return_wf : bool, = False</span>
<span class="sd">            If True, the wavefront object after propagation is returned.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        psf : Array</span>
<span class="sd">            The monochromatic point spread function after being propagated</span>
<span class="sd">            though the optical layers.</span>
<span class="sd">        wavefront : Wavefront</span>
<span class="sd">            The wavefront object after propagation. Only returned if</span>
<span class="sd">            return_wf is True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">wf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_aperture</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>

        <span class="c1"># Propagate</span>
        <span class="n">pixel_scale</span> <span class="o">=</span> <span class="mf">1e-6</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">psf_pixel_scale</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">psf_oversample</span>
        <span class="n">wf</span> <span class="o">=</span> <span class="n">wf</span><span class="o">.</span><span class="n">MFT</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psf_npixels</span><span class="p">,</span> <span class="n">pixel_scale</span><span class="p">,</span> 
            <span class="n">focal_length</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">focal_length</span><span class="p">)</span>

        <span class="c1"># Return PSF or Wavefront</span>
        <span class="k">if</span> <span class="n">return_wf</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">wf</span>
        <span class="k">return</span> <span class="n">wf</span><span class="o">.</span><span class="n">psf</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="dLux.optics.CartesianOptics.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">wf_npixels</span><span class="p">,</span> <span class="n">diameter</span><span class="p">,</span> <span class="n">aperture</span><span class="p">,</span> <span class="n">focal_length</span><span class="p">,</span> <span class="n">psf_npixels</span><span class="p">,</span> <span class="n">psf_pixel_scale</span><span class="p">,</span> <span class="n">psf_oversample</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#dLux.optics.CartesianOptics.__init__" class="headerlink" title="Permanent link">¤</a></h2>


  <div class="doc doc-contents ">
  

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>wf_npixels</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The number of pixels representing the wavefront.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>diameter</code></td>
          <td>
                <code><span title="jax.Array">Array</span>, meters</code>
          </td>
          <td><p>The diameter of the initial wavefront to propagte.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>aperture</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="jax.Array">Array</span>, <span title="dLux.optics.OpticalLayer">OpticalLayer</span>]</code>
          </td>
          <td><p>The aperture of the system. Can be an Array or a OpticalLayer.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>focal_length</code></td>
          <td>
                <code>float, meters</code>
          </td>
          <td><p>The focal length of the optical system.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>psf_npixels</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The number of pixels of the final PSF.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>psf_pixel_scale</code></td>
          <td>
                <code>float, microns</code>
          </td>
          <td><p>The pixel scale of the final PSF in units of microns.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>psf_oversample</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>The oversampling factor of the final PSF.</p></td>
          <td>
                <code>1</code>
          </td>
        </tr>
        <tr>
          <td><code>mask</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="jax.Array">Array</span>, <span title="dLux.optics.OpticalLayer">OpticalLayer</span>]</code>
          </td>
          <td><p>The mask to apply to the wavefront. Can be an Array or an
OpticalLayer. If an Array it is treated as a transmissive mask.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>dLux/optics.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span>            <span class="p">:</span> <span class="n">CartesianOptics</span><span class="p">,</span>
             <span class="n">wf_npixels</span>      <span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
             <span class="n">diameter</span>        <span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
             <span class="n">aperture</span>        <span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Array</span><span class="p">,</span> <span class="n">OpticalLayer</span><span class="p">()],</span>
             <span class="n">focal_length</span>    <span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
             <span class="n">psf_npixels</span>     <span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
             <span class="n">psf_pixel_scale</span> <span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
             <span class="n">psf_oversample</span>  <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">mask</span>            <span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Array</span><span class="p">,</span> <span class="n">OpticalLayer</span><span class="p">()]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    wf_npixels : int</span>
<span class="sd">        The number of pixels representing the wavefront.</span>
<span class="sd">    diameter : Array, meters</span>
<span class="sd">        The diameter of the initial wavefront to propagte.</span>
<span class="sd">    aperture : Union[Array, OpticalLayer]</span>
<span class="sd">        The aperture of the system. Can be an Array or a OpticalLayer.</span>
<span class="sd">    focal_length : float, meters</span>
<span class="sd">        The focal length of the optical system.</span>
<span class="sd">    psf_npixels : int</span>
<span class="sd">        The number of pixels of the final PSF.</span>
<span class="sd">    psf_pixel_scale : float, microns</span>
<span class="sd">        The pixel scale of the final PSF in units of microns.</span>
<span class="sd">    psf_oversample : float</span>
<span class="sd">        The oversampling factor of the final PSF.</span>
<span class="sd">    mask : Union[Array, OpticalLayer] = None</span>
<span class="sd">        The mask to apply to the wavefront. Can be an Array or an</span>
<span class="sd">        OpticalLayer. If an Array it is treated as a transmissive mask.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">focal_length</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">focal_length</span><span class="p">)</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">wf_npixels</span><span class="o">=</span><span class="n">wf_npixels</span><span class="p">,</span> <span class="n">diameter</span><span class="o">=</span><span class="n">diameter</span><span class="p">,</span>
        <span class="n">aperture</span><span class="o">=</span><span class="n">aperture</span><span class="p">,</span> <span class="n">psf_npixels</span><span class="o">=</span><span class="n">psf_npixels</span><span class="p">,</span>
        <span class="n">psf_pixel_scale</span><span class="o">=</span><span class="n">psf_pixel_scale</span><span class="p">,</span> <span class="n">psf_oversample</span><span class="o">=</span><span class="n">psf_oversample</span><span class="p">,</span>
        <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="dLux.optics.CartesianOptics.propagate_mono" class="doc doc-heading">
<code class="highlight language-python"><span class="n">propagate_mono</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">return_wf</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#dLux.optics.CartesianOptics.propagate_mono" class="headerlink" title="Permanent link">¤</a></h2>


  <div class="doc doc-contents ">
  
      <p>Propagates a monochromatic point source through the optical layers.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>wavelength</code></td>
          <td>
                <code><span title="jax.Array">Array</span>, meters</code>
          </td>
          <td><p>The wavelength of the wavefront to propagate through the optical
layers.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>offset</code></td>
          <td>
                <code><span title="jax.Array">Array</span>, radians</code>
          </td>
          <td><p>The (x, y) offset from the optical axis of the source. Default
value is (0, 0), on axis.</p></td>
          <td>
                <code>np.zeros(2)</code>
          </td>
        </tr>
        <tr>
          <td><code>return_wf</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>If True, the wavefront object after propagation is returned.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>psf</code></td>          <td>
                <code><span title="jax.Array">Array</span></code>
          </td>
          <td><p>The monochromatic point spread function after being propagated
though the optical layers.</p></td>
        </tr>
        <tr>
<td><code>wavefront</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="dLux.wavefronts.Wavefront" href="../wavefronts/#dLux.wavefronts.Wavefront">Wavefront</a></code>
          </td>
          <td><p>The wavefront object after propagation. Only returned if
return_wf is True.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>dLux/optics.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">propagate_mono</span><span class="p">(</span><span class="bp">self</span>       <span class="p">:</span> <span class="n">SimpleToliman</span><span class="p">,</span>
                   <span class="n">wavelength</span> <span class="p">:</span> <span class="n">Array</span><span class="p">,</span>
                   <span class="n">offset</span>     <span class="p">:</span> <span class="n">Array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
                   <span class="n">return_wf</span>  <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Propagates a monochromatic point source through the optical layers.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    wavelength : Array, meters</span>
<span class="sd">        The wavelength of the wavefront to propagate through the optical</span>
<span class="sd">        layers.</span>
<span class="sd">    offset : Array, radians, = np.zeros(2)</span>
<span class="sd">        The (x, y) offset from the optical axis of the source. Default</span>
<span class="sd">        value is (0, 0), on axis.</span>
<span class="sd">    return_wf : bool, = False</span>
<span class="sd">        If True, the wavefront object after propagation is returned.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    psf : Array</span>
<span class="sd">        The monochromatic point spread function after being propagated</span>
<span class="sd">        though the optical layers.</span>
<span class="sd">    wavefront : Wavefront</span>
<span class="sd">        The wavefront object after propagation. Only returned if</span>
<span class="sd">        return_wf is True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">wf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_aperture</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>

    <span class="c1"># Propagate</span>
    <span class="n">pixel_scale</span> <span class="o">=</span> <span class="mf">1e-6</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">psf_pixel_scale</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">psf_oversample</span>
    <span class="n">wf</span> <span class="o">=</span> <span class="n">wf</span><span class="o">.</span><span class="n">MFT</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psf_npixels</span><span class="p">,</span> <span class="n">pixel_scale</span><span class="p">,</span> 
        <span class="n">focal_length</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">focal_length</span><span class="p">)</span>

    <span class="c1"># Return PSF or Wavefront</span>
    <span class="k">if</span> <span class="n">return_wf</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">wf</span>
    <span class="k">return</span> <span class="n">wf</span><span class="o">.</span><span class="n">psf</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h2 data-role="class" id="dLux.optics.CartesianOptics"><a class="headerlink" href="#dLux.optics.CartesianOptics" title="Permanent link">¤</a></h2>
<h2 class="doc doc-heading" data-role="function" id="dLux.optics.CartesianOptics.__init__"><a class="headerlink" href="#dLux.optics.CartesianOptics.__init__" title="Permanent link">¤</a></h2>
<h2 class="doc doc-heading" data-role="function" id="dLux.optics.CartesianOptics.propagate_mono"><a class="headerlink" href="#dLux.optics.CartesianOptics.propagate_mono" title="Permanent link">¤</a></h2>
</div>
</details>
<p>The following code snippet shows how to construct a simple optical system and propagate a point source through it.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">jax.numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">dLux</span> <span class="k">as</span> <span class="nn">dl</span>

<span class="c1"># Define the parameters</span>
<span class="n">wf_npixels</span> <span class="o">=</span> <span class="mi">256</span>
<span class="n">diameter</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># meters</span>
<span class="n">focal_length</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># meters</span>
<span class="n">psf_npixels</span> <span class="o">=</span> <span class="mi">128</span>
<span class="n">psf_pixel_scale</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># microns</span>
<span class="n">psf_oversample</span> <span class="o">=</span> <span class="mi">4</span>

<span class="c1"># Use ApertureFactory class to make a simple circular aperture</span>
<span class="n">aperture</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">ApertureFactory</span><span class="p">(</span><span class="n">wf_npixels</span><span class="p">)</span>

<span class="c1"># Construct the optics class</span>
<span class="n">optics</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">CartesianOptics</span><span class="p">(</span><span class="n">wf_npixels</span><span class="p">,</span> <span class="n">diameter</span><span class="p">,</span> <span class="n">aperture</span><span class="p">,</span> <span class="n">focal_length</span><span class="p">,</span>
    <span class="n">psf_npixels</span><span class="p">,</span> <span class="n">psf_pixel_scale</span><span class="p">,</span> <span class="n">psf_oversample</span><span class="p">)</span>

<span class="c1"># Propagate the wavelengths</span>
<span class="n">wavelengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1.2e-6</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="c1"># meters</span>
<span class="n">psf</span> <span class="o">=</span> <span class="n">optics</span><span class="o">.</span><span class="n">propagate</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">)</span>
</code></pre></div>
<details class="abstract">
<summary>Plotting Code</summary>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Aperture&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">optics</span><span class="o">.</span><span class="n">aperture</span><span class="o">.</span><span class="n">transmission</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;$\sqrt</span><span class="si">{PSF}</span><span class="s2">$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">psf</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;cartesian_psf.png&#39;</span><span class="p">)</span>
</code></pre></div>
</details>
<p><img alt="cartesian_psf" src="../../assets/cartesian_psf.png" /></p>
<hr />
<h1 id="flexibleoptics">FlexibleOptics<a class="headerlink" href="#flexibleoptics" title="Permanent link">¤</a></h1>
<p>The <code>FlexibleOptics</code> class allows for the use of any <code>Propagator</code> class in dLux. Lets have a look at how we can use this propagator to model a psf with a fresnel defocus.</p>
<details class="info">
<summary>Flexible Optics API</summary>
<div class="mkdocstrings">

<div class="doc doc-object doc-class">


<a id="dLux.optics.FlexibleOptics"></a>
  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code><span title="dLux.optics.AperturedOptics">AperturedOptics</span></code>, <code><span title="dLux.optics.SimpleOptics">SimpleOptics</span></code></p>

  
      <p>A simple optical system that propagates a wavefront to an image plane
using the user-supplied propagator. This allows for propagation of fresnel
wavefronts.</p>

  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>wf_npixels</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The number of pixels representing the wavefront.</p></td>
        </tr>
        <tr>
          <td><code>diameter</code></td>
          <td>
                <code><span title="jax.Array">Array</span>, meters</code>
          </td>
          <td><p>The diameter of the initial wavefront to propagte.</p></td>
        </tr>
        <tr>
          <td><code>aperture</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="jax.Array">Array</span>, <span title="dLux.optics.OpticalLayer">OpticalLayer</span>]</code>
          </td>
          <td><p>The aperture of the system. Can be an Array or a OpticalLayer.</p></td>
        </tr>
        <tr>
          <td><code>mask</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="jax.Array">Array</span>, <span title="dLux.optics.OpticalLayer">OpticalLayer</span>]</code>
          </td>
          <td><p>The mask to apply to the wavefront. Can be an Array or an OpticalLayer.
If an Array it is treated as a transmissive mask.</p></td>
        </tr>
        <tr>
          <td><code>propagator</code></td>
          <td>
                <code><span title="dLux.optics.Propagator">Propagator</span></code>
          </td>
          <td><p>The propagator to use to propagate the wavefront through the optics.</p></td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>dLux/optics.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">FlexibleOptics</span><span class="p">(</span><span class="n">AperturedOptics</span><span class="p">,</span> <span class="n">SimpleOptics</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A simple optical system that propagates a wavefront to an image plane</span>
<span class="sd">    using the user-supplied propagator. This allows for propagation of fresnel</span>
<span class="sd">    wavefronts.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    wf_npixels : int</span>
<span class="sd">        The number of pixels representing the wavefront.</span>
<span class="sd">    diameter : Array, meters</span>
<span class="sd">        The diameter of the initial wavefront to propagte.</span>
<span class="sd">    aperture : Union[Array, OpticalLayer]</span>
<span class="sd">        The aperture of the system. Can be an Array or a OpticalLayer.</span>
<span class="sd">    mask : Union[Array, OpticalLayer]</span>
<span class="sd">        The mask to apply to the wavefront. Can be an Array or an OpticalLayer.</span>
<span class="sd">        If an Array it is treated as a transmissive mask.</span>
<span class="sd">    propagator : Propagator</span>
<span class="sd">        The propagator to use to propagate the wavefront through the optics.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">propagator</span> <span class="p">:</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span> <span class="p">:</span> <span class="n">BaseOptics</span><span class="p">,</span> 
                 <span class="n">wf_npixels</span> <span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                 <span class="n">diameter</span> <span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                 <span class="n">aperture</span> <span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Array</span><span class="p">,</span> <span class="n">OpticalLayer</span><span class="p">()],</span>
                 <span class="n">propagator</span> <span class="p">:</span> <span class="n">Propagator</span><span class="p">(),</span>
                 <span class="n">mask</span> <span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Array</span><span class="p">,</span> <span class="n">OpticalLayer</span><span class="p">()]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        wf_npixels : int</span>
<span class="sd">            The number of pixels representing the wavefront.</span>
<span class="sd">        diameter : Array, meters</span>
<span class="sd">            The diameter of the initial wavefront to propagte.</span>
<span class="sd">        aperture : Union[Array, OpticalLayer]</span>
<span class="sd">            The aperture of the system. Can be an Array or a OpticalLayer.</span>
<span class="sd">        propagator : Propagator</span>
<span class="sd">            The propagator to use to propagate the wavefront through the optics.</span>
<span class="sd">        mask : Union[Array, OpticalLayer] = None</span>
<span class="sd">            The mask to apply to the wavefront. Can be an Array or an</span>
<span class="sd">            OpticalLayer. If an Array it is treated as a transmissive mask.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">propagator</span><span class="p">,</span> <span class="n">Propagator</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;propagator must be a Propagator object, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">propagator</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">propagator</span> <span class="o">=</span> <span class="n">propagator</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">wf_npixels</span><span class="o">=</span><span class="n">wf_npixels</span><span class="p">,</span> <span class="n">diameter</span><span class="o">=</span><span class="n">diameter</span><span class="p">,</span>
            <span class="n">aperture</span><span class="o">=</span><span class="n">aperture</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">true_pixel_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the true pixel scale of the PSF.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">propagator</span><span class="o">.</span><span class="n">pixel_scale</span>

    <span class="k">def</span> <span class="nf">_construct_wavefront</span><span class="p">(</span>
        <span class="bp">self</span>       <span class="p">:</span> <span class="n">BaseOptics</span><span class="p">,</span>
        <span class="n">wavelength</span> <span class="p">:</span> <span class="n">Array</span><span class="p">,</span>
        <span class="n">offset</span>     <span class="p">:</span> <span class="n">Array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructs the appropriate tilted wavefront object for the optical</span>
<span class="sd">        system.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        wavelength : Array, meters</span>
<span class="sd">            The wavelength of the wavefront to propagate through the optics.</span>
<span class="sd">        offset : Array, radians, = np.zeros(2)</span>
<span class="sd">            The (x, y) offset from the optical axis of the source. Default</span>
<span class="sd">            value is (0, 0), on axis.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        wavefront : Wavefront</span>
<span class="sd">            The wavefront object to propagate through the optics.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">propagator</span><span class="p">,</span> <span class="n">dLux</span><span class="o">.</span><span class="n">propagators</span><span class="o">.</span><span class="n">FarFieldFresnel</span><span class="p">):</span>
            <span class="n">wf</span> <span class="o">=</span> <span class="n">dLux</span><span class="o">.</span><span class="n">FresnelWavefront</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wf_npixels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">diameter</span><span class="p">,</span> 
                <span class="n">wavelength</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wf</span> <span class="o">=</span> <span class="n">dLux</span><span class="o">.</span><span class="n">Wavefront</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wf_npixels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">diameter</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">wf</span><span class="o">.</span><span class="n">tilt</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">propagate_mono</span><span class="p">(</span><span class="bp">self</span>       <span class="p">:</span> <span class="n">SimpleToliman</span><span class="p">,</span>
                       <span class="n">wavelength</span> <span class="p">:</span> <span class="n">Array</span><span class="p">,</span>
                       <span class="n">offset</span>     <span class="p">:</span> <span class="n">Array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
                       <span class="n">return_wf</span>  <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Propagates a monochromatic point source through the optical layers.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        wavelength : Array, meters</span>
<span class="sd">            The wavelength of the wavefront to propagate through the optical</span>
<span class="sd">            layers.</span>
<span class="sd">        offset : Array, radians, = np.zeros(2)</span>
<span class="sd">            The (x, y) offset from the optical axis of the source. Default</span>
<span class="sd">            value is (0, 0), on axis.</span>
<span class="sd">        return_wf : bool, = False</span>
<span class="sd">            If True, the wavefront object after propagation is returned.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        psf : Array</span>
<span class="sd">            The monochromatic point spread function after being propagated</span>
<span class="sd">            though the optical layers.</span>
<span class="sd">        wavefront : Wavefront</span>
<span class="sd">            The wavefront object after propagation. Only returned if</span>
<span class="sd">            return_wf is True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">wf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_aperture</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
        <span class="n">wf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">propagator</span><span class="p">(</span><span class="n">wf</span><span class="p">)</span>

        <span class="c1"># Return PSF or Wavefront</span>
        <span class="k">if</span> <span class="n">return_wf</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">wf</span>
        <span class="k">return</span> <span class="n">wf</span><span class="o">.</span><span class="n">psf</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h2 id="dLux.optics.FlexibleOptics.true_pixel_scale" class="doc doc-heading">
<code class="highlight language-python"><span class="n">true_pixel_scale</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#dLux.optics.FlexibleOptics.true_pixel_scale" class="headerlink" title="Permanent link">¤</a></h2>


  <div class="doc doc-contents ">
  
      <p>Returns the true pixel scale of the PSF.</p>
  </div>

</div>



<div class="doc doc-object doc-function">



<h2 id="dLux.optics.FlexibleOptics.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">wf_npixels</span><span class="p">,</span> <span class="n">diameter</span><span class="p">,</span> <span class="n">aperture</span><span class="p">,</span> <span class="n">propagator</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#dLux.optics.FlexibleOptics.__init__" class="headerlink" title="Permanent link">¤</a></h2>


  <div class="doc doc-contents ">
  

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>wf_npixels</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The number of pixels representing the wavefront.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>diameter</code></td>
          <td>
                <code><span title="jax.Array">Array</span>, meters</code>
          </td>
          <td><p>The diameter of the initial wavefront to propagte.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>aperture</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="jax.Array">Array</span>, <span title="dLux.optics.OpticalLayer">OpticalLayer</span>]</code>
          </td>
          <td><p>The aperture of the system. Can be an Array or a OpticalLayer.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>propagator</code></td>
          <td>
                <code><span title="dLux.optics.Propagator">Propagator</span></code>
          </td>
          <td><p>The propagator to use to propagate the wavefront through the optics.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>mask</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="jax.Array">Array</span>, <span title="dLux.optics.OpticalLayer">OpticalLayer</span>]</code>
          </td>
          <td><p>The mask to apply to the wavefront. Can be an Array or an
OpticalLayer. If an Array it is treated as a transmissive mask.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>dLux/optics.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span> <span class="p">:</span> <span class="n">BaseOptics</span><span class="p">,</span> 
             <span class="n">wf_npixels</span> <span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
             <span class="n">diameter</span> <span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
             <span class="n">aperture</span> <span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Array</span><span class="p">,</span> <span class="n">OpticalLayer</span><span class="p">()],</span>
             <span class="n">propagator</span> <span class="p">:</span> <span class="n">Propagator</span><span class="p">(),</span>
             <span class="n">mask</span> <span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Array</span><span class="p">,</span> <span class="n">OpticalLayer</span><span class="p">()]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    wf_npixels : int</span>
<span class="sd">        The number of pixels representing the wavefront.</span>
<span class="sd">    diameter : Array, meters</span>
<span class="sd">        The diameter of the initial wavefront to propagte.</span>
<span class="sd">    aperture : Union[Array, OpticalLayer]</span>
<span class="sd">        The aperture of the system. Can be an Array or a OpticalLayer.</span>
<span class="sd">    propagator : Propagator</span>
<span class="sd">        The propagator to use to propagate the wavefront through the optics.</span>
<span class="sd">    mask : Union[Array, OpticalLayer] = None</span>
<span class="sd">        The mask to apply to the wavefront. Can be an Array or an</span>
<span class="sd">        OpticalLayer. If an Array it is treated as a transmissive mask.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">propagator</span><span class="p">,</span> <span class="n">Propagator</span><span class="p">()):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;propagator must be a Propagator object, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">propagator</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">propagator</span> <span class="o">=</span> <span class="n">propagator</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">wf_npixels</span><span class="o">=</span><span class="n">wf_npixels</span><span class="p">,</span> <span class="n">diameter</span><span class="o">=</span><span class="n">diameter</span><span class="p">,</span>
        <span class="n">aperture</span><span class="o">=</span><span class="n">aperture</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="dLux.optics.FlexibleOptics.propagate_mono" class="doc doc-heading">
<code class="highlight language-python"><span class="n">propagate_mono</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">return_wf</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#dLux.optics.FlexibleOptics.propagate_mono" class="headerlink" title="Permanent link">¤</a></h2>


  <div class="doc doc-contents ">
  
      <p>Propagates a monochromatic point source through the optical layers.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>wavelength</code></td>
          <td>
                <code><span title="jax.Array">Array</span>, meters</code>
          </td>
          <td><p>The wavelength of the wavefront to propagate through the optical
layers.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>offset</code></td>
          <td>
                <code><span title="jax.Array">Array</span>, radians</code>
          </td>
          <td><p>The (x, y) offset from the optical axis of the source. Default
value is (0, 0), on axis.</p></td>
          <td>
                <code>np.zeros(2)</code>
          </td>
        </tr>
        <tr>
          <td><code>return_wf</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>If True, the wavefront object after propagation is returned.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>psf</code></td>          <td>
                <code><span title="jax.Array">Array</span></code>
          </td>
          <td><p>The monochromatic point spread function after being propagated
though the optical layers.</p></td>
        </tr>
        <tr>
<td><code>wavefront</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="dLux.wavefronts.Wavefront" href="../wavefronts/#dLux.wavefronts.Wavefront">Wavefront</a></code>
          </td>
          <td><p>The wavefront object after propagation. Only returned if
return_wf is True.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>dLux/optics.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">propagate_mono</span><span class="p">(</span><span class="bp">self</span>       <span class="p">:</span> <span class="n">SimpleToliman</span><span class="p">,</span>
                   <span class="n">wavelength</span> <span class="p">:</span> <span class="n">Array</span><span class="p">,</span>
                   <span class="n">offset</span>     <span class="p">:</span> <span class="n">Array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
                   <span class="n">return_wf</span>  <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Propagates a monochromatic point source through the optical layers.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    wavelength : Array, meters</span>
<span class="sd">        The wavelength of the wavefront to propagate through the optical</span>
<span class="sd">        layers.</span>
<span class="sd">    offset : Array, radians, = np.zeros(2)</span>
<span class="sd">        The (x, y) offset from the optical axis of the source. Default</span>
<span class="sd">        value is (0, 0), on axis.</span>
<span class="sd">    return_wf : bool, = False</span>
<span class="sd">        If True, the wavefront object after propagation is returned.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    psf : Array</span>
<span class="sd">        The monochromatic point spread function after being propagated</span>
<span class="sd">        though the optical layers.</span>
<span class="sd">    wavefront : Wavefront</span>
<span class="sd">        The wavefront object after propagation. Only returned if</span>
<span class="sd">        return_wf is True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">wf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_aperture</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
    <span class="n">wf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">propagator</span><span class="p">(</span><span class="n">wf</span><span class="p">)</span>

    <span class="c1"># Return PSF or Wavefront</span>
    <span class="k">if</span> <span class="n">return_wf</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">wf</span>
    <span class="k">return</span> <span class="n">wf</span><span class="o">.</span><span class="n">psf</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h2 data-role="class" id="dLux.optics.FlexibleOptics"><a class="headerlink" href="#dLux.optics.FlexibleOptics" title="Permanent link">¤</a></h2>
<h2 class="doc doc-heading" data-role="attr" id="dLux.optics.FlexibleOptics.true_pixel_scale"><a class="headerlink" href="#dLux.optics.FlexibleOptics.true_pixel_scale" title="Permanent link">¤</a></h2>
<h2 class="doc doc-heading" data-role="function" id="dLux.optics.FlexibleOptics.__init__"><a class="headerlink" href="#dLux.optics.FlexibleOptics.__init__" title="Permanent link">¤</a></h2>
<h2 class="doc doc-heading" data-role="function" id="dLux.optics.FlexibleOptics.propagate_mono"><a class="headerlink" href="#dLux.optics.FlexibleOptics.propagate_mono" title="Permanent link">¤</a></h2>
</div>
</details>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">jax.numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">dLux</span> <span class="k">as</span> <span class="nn">dl</span>

<span class="c1"># Define the parameters</span>
<span class="n">wf_npixels</span> <span class="o">=</span> <span class="mi">256</span>
<span class="n">diameter</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># meters</span>
<span class="n">focal_length</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># meters</span>
<span class="n">psf_npixels</span> <span class="o">=</span> <span class="mi">128</span>
<span class="n">psf_pixel_scale</span> <span class="o">=</span> <span class="mf">0.25e-6</span> <span class="c1"># meters</span>
<span class="n">focal_shift</span> <span class="o">=</span> <span class="mf">2e-5</span> <span class="c1"># meters</span>

<span class="c1"># Use ApertureFactory class to make a simple circular aperture</span>
<span class="n">aperture</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">ApertureFactory</span><span class="p">(</span><span class="n">wf_npixels</span><span class="p">)</span>

<span class="c1"># Construct a Fresnel Propagator</span>
<span class="n">propagator</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">FarFieldFresnel</span><span class="p">(</span><span class="n">psf_npixels</span><span class="p">,</span> <span class="n">psf_pixel_scale</span><span class="p">,</span> <span class="n">focal_length</span><span class="p">,</span>
    <span class="n">focal_shift</span><span class="p">)</span>

<span class="c1"># Construct the optics class</span>
<span class="n">optics</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">FlexibleOptics</span><span class="p">(</span><span class="n">wf_npixels</span><span class="p">,</span> <span class="n">diameter</span><span class="p">,</span> <span class="n">aperture</span><span class="p">,</span> <span class="n">propagator</span><span class="p">)</span>

<span class="c1"># Propagate the wavelengths</span>
<span class="n">wavelengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1.2e-6</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="c1"># meters</span>
<span class="n">psf</span> <span class="o">=</span> <span class="n">optics</span><span class="o">.</span><span class="n">propagate</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">)</span>
</code></pre></div>
<details class="abstract">
<summary>Plotting code</summary>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Aperture&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">optics</span><span class="o">.</span><span class="n">aperture</span><span class="o">.</span><span class="n">transmission</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;$\sqrt</span><span class="si">{PSF}</span><span class="s2">$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">psf</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;fresnel_psf.png&#39;</span><span class="p">)</span>
</code></pre></div>
</details>
<p><img alt="fresnel_psf" src="../../assets/fresnel_psf.png" /></p>
<hr />
<h2 id="layeredoptics">LayeredOptics<a class="headerlink" href="#layeredoptics" title="Permanent link">¤</a></h2>
<p>The Layered Optics class allows us to define a list of <code>OpticalLayers</code> that operate on a wavefront. This allows us to model more complex optical systems than the previous classes, while also allowing users to define their own OpticalLayers! Look at the OpticalLayers documentation for more information.</p>
<details class="info">
<summary>Layered Optics API</summary>
<div class="mkdocstrings">

<div class="doc doc-object doc-class">


<a id="dLux.optics.LayeredOptics"></a>
  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code><span title="dLux.optics.SimpleOptics">SimpleOptics</span></code></p>

  
      <p>A fully flexible optical system that allows for the arbitrary chaining of
dLux OpticalLayers.</p>

  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>wf_npixels</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The size of the initial wavefront to propagte.</p></td>
        </tr>
        <tr>
          <td><code>diameter</code></td>
          <td>
                <code><span title="jax.Array">Array</span></code>
          </td>
          <td><p>The diameter of the wavefront to model through the system in meters.</p></td>
        </tr>
        <tr>
          <td><code>layers</code></td>
          <td>
                <code>OrderedDict</code>
          </td>
          <td><p>A collections.OrderedDict of 'layers' that define the transformations
and operations upon some input wavefront through an optical system.</p></td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>dLux/optics.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">LayeredOptics</span><span class="p">(</span><span class="n">SimpleOptics</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A fully flexible optical system that allows for the arbitrary chaining of</span>
<span class="sd">    dLux OpticalLayers.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    wf_npixels : int</span>
<span class="sd">        The size of the initial wavefront to propagte.</span>
<span class="sd">    diameter : Array</span>
<span class="sd">        The diameter of the wavefront to model through the system in meters.</span>
<span class="sd">    layers : OrderedDict</span>
<span class="sd">        A collections.OrderedDict of &#39;layers&#39; that define the transformations</span>
<span class="sd">        and operations upon some input wavefront through an optical system.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">layers</span> <span class="p">:</span> <span class="n">OrderedDict</span>


    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span>       <span class="p">:</span> <span class="n">Optics</span><span class="p">,</span> 
                 <span class="n">wf_npixels</span> <span class="p">:</span> <span class="nb">int</span><span class="p">,</span> 
                 <span class="n">diameter</span>   <span class="p">:</span> <span class="nb">float</span><span class="p">,</span> 
                 <span class="n">layers</span>     <span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optics</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor for the Optics class.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        wf_npixels : int</span>
<span class="sd">            The number of pixels to use when propagating the wavefront through</span>
<span class="sd">            the optical system.</span>
<span class="sd">        diameter : float</span>
<span class="sd">            The diameter of the wavefront to model through the system in meters.</span>
<span class="sd">        layers : list</span>
<span class="sd">            A list of dLux &#39;layers&#39; that define the transformations and</span>
<span class="sd">            operations upon some input wavefront through an optical system.</span>
<span class="sd">            The entried can either be dLux OtpicalLayers, or tuples of the</span>
<span class="sd">            form (OpticalLayer, key), with the key being used as the dictionary</span>
<span class="sd">            key for the layer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">wf_npixels</span><span class="o">=</span><span class="n">wf_npixels</span><span class="p">,</span> <span class="n">diameter</span><span class="o">=</span><span class="n">diameter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="n">dlu</span><span class="o">.</span><span class="n">list_to_dictionary</span><span class="p">(</span><span class="n">layers</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">OpticalLayer</span><span class="p">())</span>


    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span> <span class="p">:</span> <span class="n">Optics</span><span class="p">,</span> <span class="n">key</span> <span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Magic method designed to allow accessing of the various items within</span>
<span class="sd">        the layers dictionary of this class via the &#39;class.attribute&#39; method.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : str</span>
<span class="sd">            The key of the item to be searched for in the layers dictionary.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        item : object</span>
<span class="sd">            The item corresponding to the supplied key in the layers dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__getattr__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">true_pixel_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the true pixel scale of the PSF.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Note: This is a bit inefficient, but should work</span>
        <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">Propagator</span><span class="p">()):</span>
                <span class="n">propagator</span> <span class="o">=</span> <span class="n">layer</span>
        <span class="k">return</span> <span class="n">propagator</span><span class="o">.</span><span class="n">pixel_scale</span>


    <span class="k">def</span> <span class="nf">propagate_mono</span><span class="p">(</span>
        <span class="bp">self</span>       <span class="p">:</span> <span class="n">BaseOptics</span><span class="p">,</span>
        <span class="n">wavelength</span> <span class="p">:</span> <span class="n">Array</span><span class="p">,</span>
        <span class="n">offset</span>     <span class="p">:</span> <span class="n">Array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
        <span class="n">return_wf</span>  <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Propagates a monochromatic point source through the optical layers.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        wavelength : Array, meters</span>
<span class="sd">            The wavelength of the wavefront to propagate through the optical</span>
<span class="sd">            layers.</span>
<span class="sd">        offset : Array, radians, = np.zeros(2)</span>
<span class="sd">            The (x, y) offset from the optical axis of the source. Default</span>
<span class="sd">            value is (0, 0), on axis.</span>
<span class="sd">        return_wf : bool, = False</span>
<span class="sd">            If True, the wavefront object after propagation is returned.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        psf : Array</span>
<span class="sd">            The monochromatic point spread function after being propagated</span>
<span class="sd">            though the optical layers.</span>
<span class="sd">        wavefront : Wavefront</span>
<span class="sd">            The wavefront object after propagation. Only returned if</span>
<span class="sd">            return_wf is True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">wavefront</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_construct_wavefront</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="n">wavefront</span> <span class="o">*=</span> <span class="n">layer</span>

        <span class="k">if</span> <span class="n">return_wf</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">wavefront</span>
        <span class="k">return</span> <span class="n">wavefront</span><span class="o">.</span><span class="n">psf</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h2 id="dLux.optics.LayeredOptics.true_pixel_scale" class="doc doc-heading">
<code class="highlight language-python"><span class="n">true_pixel_scale</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#dLux.optics.LayeredOptics.true_pixel_scale" class="headerlink" title="Permanent link">¤</a></h2>


  <div class="doc doc-contents ">
  
      <p>Returns the true pixel scale of the PSF.</p>
  </div>

</div>



<div class="doc doc-object doc-function">



<h2 id="dLux.optics.LayeredOptics.__getattr__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__getattr__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span></code>

<a href="#dLux.optics.LayeredOptics.__getattr__" class="headerlink" title="Permanent link">¤</a></h2>


  <div class="doc doc-contents ">
  
      <p>Magic method designed to allow accessing of the various items within
the layers dictionary of this class via the 'class.attribute' method.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>key</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The key of the item to be searched for in the layers dictionary.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>item</code></td>          <td>
                <code>object</code>
          </td>
          <td><p>The item corresponding to the supplied key in the layers dictionary.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>dLux/optics.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span> <span class="p">:</span> <span class="n">Optics</span><span class="p">,</span> <span class="n">key</span> <span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Magic method designed to allow accessing of the various items within</span>
<span class="sd">    the layers dictionary of this class via the &#39;class.attribute&#39; method.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    key : str</span>
<span class="sd">        The key of the item to be searched for in the layers dictionary.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    item : object</span>
<span class="sd">        The item corresponding to the supplied key in the layers dictionary.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__getattr__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="dLux.optics.LayeredOptics.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">wf_npixels</span><span class="p">,</span> <span class="n">diameter</span><span class="p">,</span> <span class="n">layers</span><span class="p">)</span></code>

<a href="#dLux.optics.LayeredOptics.__init__" class="headerlink" title="Permanent link">¤</a></h2>


  <div class="doc doc-contents ">
  
      <p>Constructor for the Optics class.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>wf_npixels</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The number of pixels to use when propagating the wavefront through
the optical system.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>diameter</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>The diameter of the wavefront to model through the system in meters.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>layers</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>A list of dLux 'layers' that define the transformations and
operations upon some input wavefront through an optical system.
The entried can either be dLux OtpicalLayers, or tuples of the
form (OpticalLayer, key), with the key being used as the dictionary
key for the layer.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>dLux/optics.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span>       <span class="p">:</span> <span class="n">Optics</span><span class="p">,</span> 
             <span class="n">wf_npixels</span> <span class="p">:</span> <span class="nb">int</span><span class="p">,</span> 
             <span class="n">diameter</span>   <span class="p">:</span> <span class="nb">float</span><span class="p">,</span> 
             <span class="n">layers</span>     <span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optics</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constructor for the Optics class.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    wf_npixels : int</span>
<span class="sd">        The number of pixels to use when propagating the wavefront through</span>
<span class="sd">        the optical system.</span>
<span class="sd">    diameter : float</span>
<span class="sd">        The diameter of the wavefront to model through the system in meters.</span>
<span class="sd">    layers : list</span>
<span class="sd">        A list of dLux &#39;layers&#39; that define the transformations and</span>
<span class="sd">        operations upon some input wavefront through an optical system.</span>
<span class="sd">        The entried can either be dLux OtpicalLayers, or tuples of the</span>
<span class="sd">        form (OpticalLayer, key), with the key being used as the dictionary</span>
<span class="sd">        key for the layer.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">wf_npixels</span><span class="o">=</span><span class="n">wf_npixels</span><span class="p">,</span> <span class="n">diameter</span><span class="o">=</span><span class="n">diameter</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="n">dlu</span><span class="o">.</span><span class="n">list_to_dictionary</span><span class="p">(</span><span class="n">layers</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">OpticalLayer</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="dLux.optics.LayeredOptics.propagate_mono" class="doc doc-heading">
<code class="highlight language-python"><span class="n">propagate_mono</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">return_wf</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#dLux.optics.LayeredOptics.propagate_mono" class="headerlink" title="Permanent link">¤</a></h2>


  <div class="doc doc-contents ">
  
      <p>Propagates a monochromatic point source through the optical layers.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>wavelength</code></td>
          <td>
                <code><span title="jax.Array">Array</span>, meters</code>
          </td>
          <td><p>The wavelength of the wavefront to propagate through the optical
layers.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>offset</code></td>
          <td>
                <code><span title="jax.Array">Array</span>, radians</code>
          </td>
          <td><p>The (x, y) offset from the optical axis of the source. Default
value is (0, 0), on axis.</p></td>
          <td>
                <code>np.zeros(2)</code>
          </td>
        </tr>
        <tr>
          <td><code>return_wf</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>If True, the wavefront object after propagation is returned.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>psf</code></td>          <td>
                <code><span title="jax.Array">Array</span></code>
          </td>
          <td><p>The monochromatic point spread function after being propagated
though the optical layers.</p></td>
        </tr>
        <tr>
<td><code>wavefront</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="dLux.wavefronts.Wavefront" href="../wavefronts/#dLux.wavefronts.Wavefront">Wavefront</a></code>
          </td>
          <td><p>The wavefront object after propagation. Only returned if
return_wf is True.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>dLux/optics.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">propagate_mono</span><span class="p">(</span>
    <span class="bp">self</span>       <span class="p">:</span> <span class="n">BaseOptics</span><span class="p">,</span>
    <span class="n">wavelength</span> <span class="p">:</span> <span class="n">Array</span><span class="p">,</span>
    <span class="n">offset</span>     <span class="p">:</span> <span class="n">Array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
    <span class="n">return_wf</span>  <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Propagates a monochromatic point source through the optical layers.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    wavelength : Array, meters</span>
<span class="sd">        The wavelength of the wavefront to propagate through the optical</span>
<span class="sd">        layers.</span>
<span class="sd">    offset : Array, radians, = np.zeros(2)</span>
<span class="sd">        The (x, y) offset from the optical axis of the source. Default</span>
<span class="sd">        value is (0, 0), on axis.</span>
<span class="sd">    return_wf : bool, = False</span>
<span class="sd">        If True, the wavefront object after propagation is returned.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    psf : Array</span>
<span class="sd">        The monochromatic point spread function after being propagated</span>
<span class="sd">        though the optical layers.</span>
<span class="sd">    wavefront : Wavefront</span>
<span class="sd">        The wavefront object after propagation. Only returned if</span>
<span class="sd">        return_wf is True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">wavefront</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_construct_wavefront</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
        <span class="n">wavefront</span> <span class="o">*=</span> <span class="n">layer</span>

    <span class="k">if</span> <span class="n">return_wf</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">wavefront</span>
    <span class="k">return</span> <span class="n">wavefront</span><span class="o">.</span><span class="n">psf</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h2 data-role="class" id="dLux.optics.LayeredOptics"><a class="headerlink" href="#dLux.optics.LayeredOptics" title="Permanent link">¤</a></h2>
<h2 class="doc doc-heading" data-role="attr" id="dLux.optics.LayeredOptics.true_pixel_scale"><a class="headerlink" href="#dLux.optics.LayeredOptics.true_pixel_scale" title="Permanent link">¤</a></h2>
<h2 class="doc doc-heading" data-role="function" id="dLux.optics.LayeredOptics.__getattr__"><a class="headerlink" href="#dLux.optics.LayeredOptics.__getattr__" title="Permanent link">¤</a></h2>
<h2 class="doc doc-heading" data-role="function" id="dLux.optics.LayeredOptics.__init__"><a class="headerlink" href="#dLux.optics.LayeredOptics.__init__" title="Permanent link">¤</a></h2>
<h2 class="doc doc-heading" data-role="function" id="dLux.optics.LayeredOptics.propagate_mono"><a class="headerlink" href="#dLux.optics.LayeredOptics.propagate_mono" title="Permanent link">¤</a></h2>
</div>
</details>
<p>Lets have a look at how we can use this class to model a simple optical system.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">jax.numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">dLux</span> <span class="k">as</span> <span class="nn">dl</span>

<span class="c1"># Define the parameters</span>
<span class="n">wf_npixels</span> <span class="o">=</span> <span class="mi">256</span>
<span class="n">diameter</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># meters</span>
<span class="n">focal_length</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># meters</span>
<span class="n">psf_npixels</span> <span class="o">=</span> <span class="mi">128</span>
<span class="n">psf_pixel_scale</span> <span class="o">=</span> <span class="mf">0.25e-6</span> <span class="c1"># meters</span>

<span class="c1"># Construct the list of optical layers</span>
<span class="n">layers</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="n">dl</span><span class="o">.</span><span class="n">ApertureFactory</span><span class="p">(</span><span class="n">wf_npixels</span><span class="p">),</span> <span class="s1">&#39;aperture&#39;</span><span class="p">),</span>
    <span class="n">dl</span><span class="o">.</span><span class="n">MFT</span><span class="p">(</span><span class="n">psf_npixels</span><span class="p">,</span> <span class="n">psf_pixel_scale</span><span class="p">,</span> <span class="n">focal_length</span><span class="p">),</span>
<span class="p">]</span>

<span class="c1"># Construct the optics class</span>
<span class="n">optics</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">LayeredOptics</span><span class="p">(</span><span class="n">wf_npixels</span><span class="p">,</span> <span class="n">diameter</span><span class="p">,</span> <span class="n">layers</span><span class="p">)</span>

<span class="c1"># Propagate the wavelengths</span>
<span class="n">wavelengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1.2e-6</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="c1"># meters</span>
<span class="n">psf</span> <span class="o">=</span> <span class="n">optics</span><span class="o">.</span><span class="n">propagate</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">)</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Accessing Layers</p>
<p>Note that we can pass in a tuple of the form (OpticalLayer, key) to the LayeredOptics class. OpticalLayers and transformed into an OrderedDict and this key is then used for that layer. This allows us to access the layers in the class via the <code>class.attribute</code> method, ie <code>optics.aperture</code>. This can be very helpful when using zodaix methods!</p>
</div>
<details class="abstract">
<summary>Plotting code</summary>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Aperture&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">optics</span><span class="o">.</span><span class="n">aperture</span><span class="o">.</span><span class="n">transmission</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;$\sqrt</span><span class="si">{PSF}</span><span class="s2">$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">psf</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;layered_psf.png&#39;</span><span class="p">)</span>
</code></pre></div>
</details>
<p><img alt="layered_psf" src="../../assets/layered_psf.png" /></p>
<hr />
<h1 id="building-your-own-optical-system">Building your own Optical System<a class="headerlink" href="#building-your-own-optical-system" title="Permanent link">¤</a></h1>
<p><em>TODO: Add link to dLux-JWST and dLux-Toliman repos</em></p>
<p>It can often be helpful to create your own Optical System class to provide a more complex optical models. For example the dLux-JWST and dLux-Toliman repos built by the dLux devs! dLux is designed to facilitate this, requiring users to only implement two methods in order to have a class that entirely integrates with the wider dLux ecosystem.</p>
<p>Note: dLux is built in <a href="https://github.com/LouisDesdoigts/zodiax">Zodiax</a>. If you are unfamiliar, you should read <a href="https://louisdesdoigts.github.io/zodiax/docs/usage/">this tutorial</a> before this example.</p>
<p>Lets have a look at how we can create a very simple optical system from the ground up with a pixel scale in units of arcseconds, and a tranmissive mask. To do this we need to implement both the <code>__init__</code> and <code>propagate_mono</code> methods. It will have 6 attributes: <code>wf_npixels</code>, <code>diameter</code>, <code>aperture</code>, <code>mask</code>, <code>psf_pixel_scale</code>, <code>psf_npixels</code>.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">jax</span> <span class="kn">import</span> <span class="n">Array</span>
<span class="kn">import</span> <span class="nn">dLux.utils</span> <span class="k">as</span> <span class="nn">dlu</span>
<span class="kn">import</span> <span class="nn">dLux</span>

<span class="c1"># We must inherit from the base optics class, `BaseOptics`. This will integrate</span>
<span class="c1"># our class with the rest of the dLux code.</span>
<span class="k">class</span> <span class="nc">MyOptics</span><span class="p">(</span><span class="n">dLux</span><span class="o">.</span><span class="n">optics</span><span class="o">.</span><span class="n">BaseOptics</span><span class="p">):</span>
    <span class="n">wf_npixels</span>      <span class="p">:</span> <span class="nb">int</span>
    <span class="n">diameter</span>        <span class="p">:</span> <span class="nb">float</span>
    <span class="n">aperture</span>        <span class="p">:</span> <span class="n">Array</span>
    <span class="n">mask</span>            <span class="p">:</span> <span class="n">Array</span>
    <span class="n">psf_pixel_scale</span> <span class="p">:</span> <span class="nb">float</span>
    <span class="n">psf_npixels</span>     <span class="p">:</span> <span class="nb">int</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wf_npixes</span><span class="p">,</span> <span class="n">diameter</span><span class="p">,</span> <span class="n">aperture</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">psf_npixels</span><span class="p">,</span> 
        <span class="n">psf_pixel_scale</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Constructs the class&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wf_npixels</span> <span class="o">=</span> <span class="n">wf_npixels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diameter</span> <span class="o">=</span> <span class="n">diameter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aperture</span> <span class="o">=</span> <span class="n">aperture</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">psf_npixels</span> <span class="o">=</span> <span class="n">psf_npixels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">psf_pixel_scale</span> <span class="o">=</span> <span class="n">psf_pixel_scale</span>

    <span class="c1"># Our propagate_mono must have the expected behaviour of dLux optics,</span>
    <span class="c1"># meaning it must take the same inputs (wavelength, offset, return_wf) and</span>
    <span class="c1"># return the same outputs (psf).</span>
    <span class="k">def</span> <span class="nf">propagate_mono</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">return_wf</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Propagates a monochromatic source&#39;&#39;&#39;</span>

        <span class="c1"># Construct our wavefront</span>
        <span class="n">wf</span> <span class="o">=</span> <span class="n">dLux</span><span class="o">.</span><span class="n">Wavefront</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wf_npixels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">diameter</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">)</span>

        <span class="c1"># Tilt the wavefront</span>
        <span class="n">wf</span> <span class="o">=</span> <span class="n">wf</span><span class="o">.</span><span class="n">tilt</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>

        <span class="c1"># We can use the `self` keyword to access the class attributes</span>
        <span class="n">wf</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aperture</span>

        <span class="c1"># Normalise the wavefront</span>
        <span class="n">wf</span> <span class="o">=</span> <span class="n">wf</span><span class="o">.</span><span class="n">normalise</span><span class="p">()</span>

        <span class="c1"># Apply the mask as an array of OPDs</span>
        <span class="n">wf</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span>

        <span class="c1"># Propagate the wavefront, casting the units of pixel scale to radians</span>
        <span class="n">pixel_scale</span> <span class="o">=</span> <span class="n">dlu</span><span class="o">.</span><span class="n">arcmin_to_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psf_pixel_scale</span><span class="p">)</span>
        <span class="n">wf</span> <span class="o">=</span> <span class="n">wf</span><span class="o">.</span><span class="n">MFT</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psf_npixels</span><span class="p">,</span> <span class="n">pixel_scale</span><span class="p">)</span>

        <span class="c1"># Return the PSF</span>
        <span class="k">if</span> <span class="n">return_wf</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">wf</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">wf</span><span class="o">.</span><span class="n">psf</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Applying Optical Layers</p>
<p>We can apply OpticalLayer and arrays to wavefronts using the <code>*=</code> operator. This is equivalent to <code>wf = layer(wf)</code>.</p>
</div>
<p>Now we can use it as per usual! This class will now be recognised by all dLux functions that take in an optics class, such as <code>Sources</code> and <code>Instruments</code></p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">jax.numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">jax.random</span> <span class="k">as</span> <span class="nn">jr</span>
<span class="kn">import</span> <span class="nn">dLux</span> <span class="k">as</span> <span class="nn">dl</span>

<span class="c1"># Define the parameters</span>
<span class="n">wf_npixels</span> <span class="o">=</span> <span class="mi">128</span>
<span class="n">diameter</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># meters</span>
<span class="n">psf_npixels</span> <span class="o">=</span> <span class="mi">128</span>
<span class="n">psf_pixel_scale</span> <span class="o">=</span> <span class="mf">5e-4</span> <span class="c1"># arcminutes</span>

<span class="c1"># Use ApertureFactory class to make a simple circular aperture</span>
<span class="n">aperture</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">ApertureFactory</span><span class="p">(</span><span class="n">wf_npixels</span><span class="p">)</span>

<span class="c1"># Make a mask of random OPDs</span>
<span class="n">mask</span> <span class="o">=</span> <span class="mf">4.e-7</span> <span class="o">*</span> <span class="n">jr</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">jr</span><span class="o">.</span><span class="n">PRNGKey</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">wf_npixels</span><span class="p">,</span> <span class="n">wf_npixels</span><span class="p">))</span>

<span class="c1"># Construct the optics class</span>
<span class="n">optics</span> <span class="o">=</span> <span class="n">MyOptics</span><span class="p">(</span><span class="n">wf_npixels</span><span class="p">,</span> <span class="n">diameter</span><span class="p">,</span> <span class="n">aperture</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">psf_npixels</span><span class="p">,</span> 
    <span class="n">psf_pixel_scale</span><span class="p">)</span>

<span class="c1"># Propagate the wavelengths</span>
<span class="n">wavelengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1.2e-6</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="c1"># meters</span>
<span class="n">psf</span> <span class="o">=</span> <span class="n">optics</span><span class="o">.</span><span class="n">propagate</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">)</span>
</code></pre></div>
<details class="abstract">
<summary>Plotting code</summary>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Aperture&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">optics</span><span class="o">.</span><span class="n">aperture</span><span class="o">.</span><span class="n">transmission</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;$\sqrt</span><span class="si">{PSF}</span><span class="s2">$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">psf</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;my_optics_psf.png&#39;</span><span class="p">)</span>
</code></pre></div>
</details>
<p><img alt="my_optics_psf" src="../../assets/my_optics_psf.png" /></p>
<hr />
<h2 id="private-classes">Private classes<a class="headerlink" href="#private-classes" title="Permanent link">¤</a></h2>
<p>To further facilitate the creation of custom optics classes, dLux provides a few base classes that can be used to build your own optics classes.</p>
<p>The private classes are as follows:</p>
<ul>
<li><code>BaseOptics</code></li>
<li><code>SimpleOptics</code></li>
<li><code>NonPropagatorOptics</code></li>
<li><code>AperturedOptics</code></li>
</ul>
<p>These classes are not intended to be used directly, but rather to be inherited from and extended. Lets look at them one by one.</p>
<p>The <code>BaseOptics</code> class is the base class for all optics classes in dLux, so if you inherit from the any of the <code>SimpleOptics</code>,<code>NonPropagatorOptics</code>, or <code>AperturedOptics</code> classes, you will automatically inherit from <code>BaseOptics</code>. It implements the<code>model</code> and <code>proapgate</code> methods, and defines the <code>propagate_mono</code> method as an abstract method. This means that any class that inherits from <code>BaseOptics</code> must implement a <code>propagate_mono</code> method with the same signature as the abstract method. This is the only requirement for a class to be recognised as an optics class by dLux.</p>
<p>The <code>SimpleOptics</code> class simply adds the <code>wf_npixels</code> and <code>diameter</code> attributes, along with a single method <code>_construct_wavefront(wavelength, offset)</code> that constructs a wavefront of the correct size and width, and performs the initial tilt from the <code>offset</code> value.</p>
<p>The <code>NonPropagatorOptics</code> class adds the <code>psf_npixels</code>, <code>psf_pixel_scale</code>, and <code>psf_oversample</code> attributes, along with a `true_pixel_scale.</p>
<p>The <code>AperturedOptics</code> class adds the <code>aperture</code> and <code>mask</code> attributes, along with a <code>_apply_aperture(wavelength, offset)</code> method that applies the aperture and mask to the wavefront, calling the <code>_construct_wavefront</code> method under the hood. Note that by default, the <code>mask</code> attribute is applied as a transmissive mask if it supplied as an array.</p>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.expand", "navigation.path", "navigation.indexes", "navigation.top", "content.code.copy", "toc.integrate"], "search": "../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.b4d07000.min.js"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>