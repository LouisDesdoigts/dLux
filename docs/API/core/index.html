
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for dLux.">
      
      
        <meta name="author" content="Louis Desdoigts">
      
      
        <link rel="canonical" href="https://louisdesdoigts.github.io/dlux/docs/API/core/">
      
      
        <link rel="prev" href="../api/">
      
      
        <link rel="next" href="../optics/">
      
      <link rel="icon" href="../../../material/telescope">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.1.6">
    
    
      
        <title>Core - dLux</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.ded33207.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="amber">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#core-classes" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="dLux" class="md-header__button md-logo" aria-label="dLux" data-md-component="logo">
      
  <img src="../../../assets/logo.jpg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            dLux
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Core
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="amber"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
            </label>
          
        
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="amber"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/LouisDesdoigts/dlux" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    louisdesdoigts/dlux
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="dLux" class="md-nav__button md-logo" aria-label="dLux" data-md-component="logo">
      
  <img src="../../../assets/logo.jpg" alt="logo">

    </a>
    dLux
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/LouisDesdoigts/dlux" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    louisdesdoigts/dlux
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Tutorials
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/" class="md-nav__link">
        Usage
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../creating_a_layer/" class="md-nav__link">
        Creating a Layer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../notebooks/phase_retrieval_demo/" class="md-nav__link">
        Phase Retrieval in dLux
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../notebooks/designing_a_mask/" class="md-nav__link">
        Phase Mask Design
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../notebooks/flatfield_calibration/" class="md-nav__link">
        Pixel Level Calibration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../notebooks/fisher_information/" class="md-nav__link">
        Fisher Information
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../notebooks/HMC/" class="md-nav__link">
        Numpyro and Hamiltonian Monte Carlo
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          dLux API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          dLux API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Core
      </a>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../optics/" class="md-nav__link">
        Optics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../apertures/" class="md-nav__link">
        Apertures
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../aberrations/" class="md-nav__link">
        Aberrations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../propagators/" class="md-nav__link">
        Propagators
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../wavefronts/" class="md-nav__link">
        Wavefronts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../detectors/" class="md-nav__link">
        Detectors
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sources/" class="md-nav__link">
        Sources
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../spectrums/" class="md-nav__link">
        Spectrums
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../observations/" class="md-nav__link">
        Observations
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Utils API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Utils API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../optics_util/" class="md-nav__link">
        Optics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../models/" class="md-nav__link">
        Models
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../units/" class="md-nav__link">
        Units
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../math.md" class="md-nav__link">
        Math
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../coordinates/" class="md-nav__link">
        Coordinates
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../interpolation/" class="md-nav__link">
        Interpolation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../bayes/" class="md-nav__link">
        Bayes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../helpers/" class="md-nav__link">
        Helpers
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../faq/" class="md-nav__link">
        FAQ & Troubleshooting
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../CHANGELOG/" class="md-nav__link">
        Change Log
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../CONTRIBUTING/" class="md-nav__link">
        Contributing
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="core-classes">Core classes<a class="headerlink" href="#core-classes" title="Permanent link">¤</a></h1>
<p>The <code>core.py</code> class contains the core classes that users will interact with. These classes are designed to be modular and allow for the creation of complex instruments. The <code>core.py</code> script contains the following classes:</p>
<ul>
<li><code>Instrument</code></li>
<li><code>Optics</code></li>
<li><code>Detector</code></li>
</ul>
<p>Lets examine the <code>Optics</code> class first as it is the core diffraction engine of dLux.</p>
<hr />
<h2 id="optics">Optics<a class="headerlink" href="#optics" title="Permanent link">¤</a></h2>
<p>The <code>Optics</code> class is the core class that controls the diffraction of wavefronts. It has only a single attribute, <code>layers</code> which is stored as an ordered dictionary, but input as a list.</p>
<div class="admonition tip">
<p class="admonition-title">Construction</p>
<p>The <code>Optics</code> class only has a single input, <code>layers</code>. This is a list of <code>Layer</code> classes that will be applied to the wavefront in the order they are given. The layers input is taken as a list and automatically converted to an ordered dictionary, populating the dictionary with the <code>name</code> parameter of each layer as the key. If there are mulitple layers with the same name parameter, the names will be modified to "original_name_0", "original_name_1" etc.</p>
<p>Here is how we would create a basic optics class:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">dLux</span> <span class="k">as</span> <span class="nn">dl</span>

<span class="n">wf_npix</span> <span class="o">=</span> <span class="mi">256</span>
<span class="n">det_npix</span> <span class="o">=</span> <span class="mi">128</span>
<span class="n">aperture_diameter</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">det_pixel_size</span> <span class="o">=</span> <span class="mf">1e-6</span>

<span class="n">layers</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">dl</span><span class="o">.</span><span class="n">CreateWavefront</span><span class="p">(</span><span class="n">wf_npix</span><span class="p">,</span> <span class="n">aperture_diameter</span><span class="p">),</span>
    <span class="n">dl</span><span class="o">.</span><span class="n">ApertureFactory</span><span class="p">(</span><span class="n">wf_npix</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Aperture&quot;</span><span class="p">),</span>
    <span class="n">dl</span><span class="o">.</span><span class="n">NormaliseWavefront</span><span class="p">(),</span>
    <span class="n">dl</span><span class="o">.</span><span class="n">AngularMFT</span><span class="p">(</span><span class="n">det_npix</span><span class="p">,</span> <span class="n">det_pixel_size</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Propagator&quot;</span><span class="p">)</span>
<span class="p">]</span>

<span class="n">optics</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">Optics</span><span class="p">(</span><span class="n">layers</span><span class="p">)</span>
</code></pre></div>
</div>
<details class="info">
<summary>Constructor API</summary>
<div class="mkdocstrings">

<div class="doc doc-object doc-function">


<a id="dLux.core.Optics.__init__"></a>
  <div class="doc doc-contents first">
  
      <p>Constructor for the Optics class.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>layers</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>A list of ∂Lux 'layers' that define the transformations and
operations upon some input wavefront through an optical system.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>dLux/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span> <span class="p">:</span> <span class="n">Optics</span><span class="p">,</span> <span class="n">layers</span> <span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optics</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constructor for the Optics class.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    layers : list</span>
<span class="sd">        A list of ∂Lux &#39;layers&#39; that define the transformations and</span>
<span class="sd">        operations upon some input wavefront through an optical system.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Ensure input is a list</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">layers</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;Input layers must be a list, it is&quot;</span> \
    <span class="s2">&quot; automatically converted to a dictionary&quot;</span><span class="p">)</span>

    <span class="c1"># Ensure all entries are dLux layers</span>
    <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">dLux</span><span class="o">.</span><span class="n">optics</span><span class="o">.</span><span class="n">OpticalLayer</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;All entries&quot;</span> \
        <span class="s2">&quot; within layers must be an dLux.optics.OpticalLayer object&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="n">dLux</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">list_to_dictionary</span><span class="p">(</span><span class="n">layers</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div><h2 data-role="function" id="dLux.core.Optics.__init__"><a class="headerlink" href="#dLux.core.Optics.__init__" title="Permanent link">¤</a></h2>
</div>
</details>
<div class="admonition info">
<p class="admonition-title">A Basic Optical Setup</p>
<p>In dLux the four layers shown above form a very basic optical train and these layers are used in almost every example.</p>
<p><code>CreateWavefont</code> should be the first layer in all optical layers as this is used to actually initialse a wavefront object that is operated on by the other layers. </p>
<p><code>ApertureFactory</code> is used to create an aperture that is applied to the wavefront. While this layer is not <em>strictly</em> nessecary, almost all models will have some form of non-square aperture and so will likely require some form of aperture layer.</p>
<p><code>NormaliseWavefront</code> is used to normalise the wavefront to a unit intensity. This simply controls at what point the wavefront is normalised to unity power. Since most calculations in optics use the collecting area of the aperture, most use cases will require this layer directly after the aperture.</p>
<p><code>AngularMFT</code> is used to propagate the wavefront from the pupil to the focal plane as is common in most optical systems. Typically at least one propagator type layer will be needed in an optical train.</p>
<p>To a degree these processes could be automated and made parameters of the <code>Optics</code> class itself, but in the goal of flexibilty and generalisability dLux instead chooses to be verbose to give users full control in order to be able to create any optical system they want.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Accessing Parameters</p>
<p>The Optics class is set up with a <code>__getattr__</code> method that is able to raise parameters from the <code>layers</code> attribute such that they can be accessed as class parameters via their name. Taking the example from above, we can access <code>Aperture</code> layer via:</p>
<div class="highlight"><pre><span></span><code><span class="n">aperture</span> <span class="o">=</span> <span class="n">optics</span><span class="o">.</span><span class="n">Aperture</span>
</code></pre></div>
<p>Without the <code>__getattr__</code> method we would have to use the following path to access the 'Aperture' layer:</p>
<div class="highlight"><pre><span></span><code><span class="n">aperture</span> <span class="o">=</span> <span class="n">optics</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="s1">&#39;Aperture&#39;</span><span class="p">]</span>
</code></pre></div>
<p>Which is a lot less nice!</p>
</div>
<p>The <code>Optics</code> has a simple API with <code>model</code> being its primary method. The <code>model</code> method takes in a source or list of sources and propagates them through the layers of the optics class.</p>
<details class="info">
<summary>model API</summary>
<div class="mkdocstrings">

<div class="doc doc-object doc-function">


<a id="dLux.core.Optics.model"></a>
  <div class="doc doc-contents first">
  
      <p>A base level modelling function for modelling the optical system.
Models the source or sources through the optics.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>sources</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="dLux.core.Source">Source</span>, dict, list]</code>
          </td>
          <td><p>The source or sources to observe.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>normalise_sources</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to normalise the sources before modelling.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>flatten</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether the output image should be flattened.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>return_tree</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to return a Pytree like object with matching tree structure
as the input sources (ie dict).</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>image</code></td>          <td>
                <code><span title="dLux.core.Array">Array</span>, dict</code>
          </td>
          <td><p>The image of the scene modelled through the optics. Returns either
as a single array (if return_tree is false), or a dict of the output
for each source.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>dLux/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">model</span><span class="p">(</span><span class="bp">self</span>              <span class="p">:</span> <span class="n">Optics</span><span class="p">,</span>
          <span class="n">sources</span>           <span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Source</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">],</span>
          <span class="n">normalise_sources</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
          <span class="n">flatten</span>           <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
          <span class="n">return_tree</span>       <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A base level modelling function for modelling the optical system.</span>
<span class="sd">    Models the source or sources through the optics.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sources : Union[Source, dict, list]</span>
<span class="sd">        The source or sources to observe.</span>
<span class="sd">    normalise_sources : bool = True</span>
<span class="sd">        Whether to normalise the sources before modelling.</span>
<span class="sd">    flatten : bool = False</span>
<span class="sd">        Whether the output image should be flattened.</span>
<span class="sd">    return_tree : bool = False</span>
<span class="sd">        Whether to return a Pytree like object with matching tree structure</span>
<span class="sd">        as the input sources (ie dict).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    image : Array, dict</span>
<span class="sd">        The image of the scene modelled through the optics. Returns either</span>
<span class="sd">        as a single array (if return_tree is false), or a dict of the output</span>
<span class="sd">        for each source.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># None input is for the detector</span>
    <span class="k">return</span> <span class="n">model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sources</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">normalise_sources</span><span class="p">,</span> <span class="n">flatten</span><span class="p">,</span>
        <span class="n">return_tree</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div><h2 data-role="function" id="dLux.core.Optics.model"><a class="headerlink" href="#dLux.core.Optics.model" title="Permanent link">¤</a></h2>
</div>
</details>
<p>It also has both <code>propagate</code> and <code>propagate_mono</code> methods, which propagate a broadband and monochromatic wavelengths through the optics class respectively. They take in either an array of wavelengths or a single wavelength and return the calcualted PSF.</p>
<details class="info">
<summary>propagate API</summary>
<div class="mkdocstrings">

<div class="doc doc-object doc-function">


<a id="dLux.core.Optics.propagate"></a>
  <div class="doc doc-contents first">
  
      <p>Propagates a broadband point source through the optical layers.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>wavelengths</code></td>
          <td>
                <code><span title="dLux.core.Array">Array</span>, meters</code>
          </td>
          <td><p>The wavelengths of the wavefront to propagate through the optical
layers.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>offset</code></td>
          <td>
                <code><span title="dLux.core.Array">Array</span>, radians</code>
          </td>
          <td><p>The (x, y) offset from the optical axis of the source. Default
value is (0, 0), on axis.</p></td>
          <td>
                <code>np.zeros(2)</code>
          </td>
        </tr>
        <tr>
          <td><code>weights</code></td>
          <td>
                <code><span title="dLux.core.Array">Array</span></code>
          </td>
          <td><p>The relative weighting of the wavelengths. Simply scales the output
psf.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>psf</code></td>          <td>
                <code><span title="dLux.core.Array">Array</span></code>
          </td>
          <td><p>The broadband point spread function after being propagated
though the optical layers.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>dLux/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">propagate</span><span class="p">(</span><span class="bp">self</span>        <span class="p">:</span> <span class="n">Optics</span><span class="p">,</span>
              <span class="n">wavelengths</span> <span class="p">:</span> <span class="n">Array</span><span class="p">,</span>
              <span class="n">offset</span>      <span class="p">:</span> <span class="n">Array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
              <span class="n">weights</span>     <span class="p">:</span> <span class="n">Array</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Propagates a broadband point source through the optical layers.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    wavelengths : Array, meters</span>
<span class="sd">        The wavelengths of the wavefront to propagate through the optical</span>
<span class="sd">        layers.</span>
<span class="sd">    offset : Array, radians = np.zeros(2)</span>
<span class="sd">        The (x, y) offset from the optical axis of the source. Default</span>
<span class="sd">        value is (0, 0), on axis.</span>
<span class="sd">    weights : Array = None</span>
<span class="sd">        The relative weighting of the wavelengths. Simply scales the output</span>
<span class="sd">        psf.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    psf : Array</span>
<span class="sd">        The broadband point spread function after being propagated</span>
<span class="sd">        though the optical layers.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Format weights input</span>
    <span class="n">wavelengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> \
              <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="k">else</span> <span class="n">wavelengths</span>
    <span class="k">assert</span> <span class="n">wavelengths</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;wavelengths must be 1 dimensional..&quot;</span>

    <span class="c1"># Format weights input</span>
    <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">))</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">weights</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;weights must be 1 dimensional.&quot;</span>

    <span class="c1"># Ensure matching dimensionality</span>
    <span class="k">assert</span> <span class="n">wavelengths</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">weights</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> \
    <span class="p">(</span><span class="s2">&quot;wavelengths and weights must have the same shape.&quot;</span><span class="p">)</span>

    <span class="c1"># Offset checking</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> \
             <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="k">else</span> <span class="n">offset</span>
    <span class="k">assert</span> <span class="n">offset</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">2</span><span class="p">,),</span> <span class="s2">&quot;offset must be shape (2,), ie (x, y).&quot;</span>

    <span class="c1"># Propagate</span>
    <span class="n">propagator</span> <span class="o">=</span> <span class="n">vmap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">propagate_mono</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">psfs</span> <span class="o">=</span> <span class="n">propagator</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">psfs</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div><h2 data-role="function" id="dLux.core.Optics.propagate"><a class="headerlink" href="#dLux.core.Optics.propagate" title="Permanent link">¤</a></h2>
</div>
</details>
<details class="info">
<summary>propagate_mono API</summary>
<div class="mkdocstrings">

<div class="doc doc-object doc-function">


<a id="dLux.core.Optics.propagate_mono"></a>
  <div class="doc doc-contents first">
  
      <p>Propagates a monochromatic point source through the optical layers.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>wavelength</code></td>
          <td>
                <code><span title="dLux.core.Array">Array</span>, meters</code>
          </td>
          <td><p>The wavelength of the wavefront to propagate through the optical
layers.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>offset</code></td>
          <td>
                <code><span title="dLux.core.Array">Array</span>, radians</code>
          </td>
          <td><p>The (x, y) offset from the optical axis of the source. Default
value is (0, 0), on axis.</p></td>
          <td>
                <code>np.zeros(2)</code>
          </td>
        </tr>
        <tr>
          <td><code>weight</code></td>
          <td>
                <code><span title="dLux.core.Array">Array</span></code>
          </td>
          <td><p>The relative weighting of the wavelength. Simply scales the output
psf.</p></td>
          <td>
                <code>np.array(1.0)</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>psf</code></td>          <td>
                <code><span title="dLux.core.Array">Array</span></code>
          </td>
          <td><p>The monochromatic point spread function after being propagated
though the optical layers.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>dLux/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">propagate_mono</span><span class="p">(</span><span class="bp">self</span>       <span class="p">:</span> <span class="n">Optics</span><span class="p">,</span>
                   <span class="n">wavelength</span> <span class="p">:</span> <span class="n">Array</span><span class="p">,</span>
                   <span class="n">offset</span>     <span class="p">:</span> <span class="n">Array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
                   <span class="n">weight</span>     <span class="p">:</span> <span class="n">Array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">1.</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Propagates a monochromatic point source through the optical layers.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    wavelength : Array, meters</span>
<span class="sd">        The wavelength of the wavefront to propagate through the optical</span>
<span class="sd">        layers.</span>
<span class="sd">    offset : Array, radians, = np.zeros(2)</span>
<span class="sd">        The (x, y) offset from the optical axis of the source. Default</span>
<span class="sd">        value is (0, 0), on axis.</span>
<span class="sd">    weight : Array, = np.array(1.)</span>
<span class="sd">        The relative weighting of the wavelength. Simply scales the output</span>
<span class="sd">        psf.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    psf : Array</span>
<span class="sd">        The monochromatic point spread function after being propagated</span>
<span class="sd">        though the optical layers.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Ensure jax arrays</span>
    <span class="n">wavelength</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> \
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="k">else</span> <span class="n">wavelength</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> \
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="k">else</span> <span class="n">offset</span>
    <span class="n">weight</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> \
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="k">else</span> <span class="n">weight</span>

    <span class="c1"># Ensure dimensionality</span>
    <span class="k">assert</span> <span class="n">wavelength</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(),</span> <span class="s2">&quot;wavelength must be a scalar.&quot;</span>
    <span class="k">assert</span> <span class="n">offset</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">2</span><span class="p">,),</span> <span class="s2">&quot;offset must be shape (2,), ie (x, y).&quot;</span>
    <span class="k">assert</span> <span class="n">weight</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(),</span> <span class="s2">&quot;weight must be a scalar.&quot;</span>

    <span class="c1"># Construct parameters dictionary</span>
    <span class="n">params_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Wavefront&quot;</span>  <span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="s2">&quot;optics&quot;</span>     <span class="p">:</span> <span class="bp">self</span><span class="p">,</span>
                   <span class="s2">&quot;wavelength&quot;</span> <span class="p">:</span> <span class="n">wavelength</span><span class="p">,</span>
                   <span class="s2">&quot;offset&quot;</span>     <span class="p">:</span> <span class="n">offset</span><span class="p">}</span>

    <span class="c1"># Propagate though layers</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">params_dict</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">params_dict</span><span class="p">)</span>
    <span class="n">psf</span> <span class="o">=</span> <span class="n">params_dict</span><span class="p">[</span><span class="s2">&quot;Wavefront&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">wavefront_to_psf</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">weight</span> <span class="o">*</span> <span class="n">psf</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div><h2 data-role="function" id="dLux.core.Optics.propagate_mono"><a class="headerlink" href="#dLux.core.Optics.propagate_mono" title="Permanent link">¤</a></h2>
</div>
</details>
<!-- It also has the methods `plot` and `summarise`. `summarise` prints a brief summary of the objects it contains and `plot` will propagate a single wavelength through the instrument and show it at intemediate states, although `plot` and `summarise` and both considered to experimental and are subject to change in the future. -->
<!-- 
??? info "plot API"
    :::dLux.core.Optics.plot -->

<!-- ??? info "summarise API"
    :::dLux.core.Optics.summarise -->

<!-- ??? info "Optics API"
    :::dLux.core.Optics -->

<hr />
<h2 id="instrument">Instrument<a class="headerlink" href="#instrument" title="Permanent link">¤</a></h2>
<p>The <code>Instrument</code> class is a high level class that is designed to control the interaction and modelling of various other classes. It has the following attributes:</p>
<ul>
<li><code>optics</code>: The <code>Optics</code> class that controls the diffraction of wavefronts.</li>
<li><code>detector</code>: The <code>Detector</code> class that controls the transformation applied by a detector.</li>
<li><code>sources</code>: The <code>Source</code> class that controls the source.</li>
<li><code>observation</code>: The <code>Observation</code> class that controls custom observation stratergies.</li>
</ul>
<p>It has a two primary methods: <code>Instrument.model()</code> &amp; <code>Instrument.observe()</code>. The <code>model</code> method will automatically propagate all the of the sources through the optics and detector if it is present. The <code>observe</code> method will instead call the <code>observe</code> method of the <code>Observation</code> class, which is designed to give fine-grained control over how the modelling is done in order to create a set of data over multiple filters, for example.</p>
<p>It also has the methods <code>normalise</code>, <code>plot</code> and <code>summarise</code>. <code>normalise</code> will normalise all sources stored within the class, <code>summarise</code> prints a brief summary of the objects it contains and <code>plot</code> will propagate a single wavelength through the instrument and show it at intemediate states, although <code>plot</code> and <code>summarise</code> and both considered to experimental and are subject to change in the future.</p>
<div class="admonition tip">
<p class="admonition-title">Construction</p>
<p>The <code>Instrument</code> class requires both an <code>Optics</code> and <code>Source</code> object, with <code>Detector</code> and <code>Observation</code> classes being optional.</p>
<p>Here is how we would create a basic instrument:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">dLux</span> <span class="k">as</span> <span class="nn">dl</span>

<span class="n">instrument</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">Instrument</span><span class="p">(</span><span class="n">optics</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
</code></pre></div>
<p>We can also pass in a list of sources if we want to model multiple sources:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">dLux</span> <span class="k">as</span> <span class="nn">dl</span>

<span class="n">instrument</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">Instrument</span><span class="p">(</span><span class="n">optics</span><span class="p">,</span> <span class="p">[</span><span class="n">source1</span><span class="p">,</span> <span class="n">source2</span><span class="p">])</span>
</code></pre></div>
</div>
<details class="info">
<summary>Constructor API</summary>
<div class="mkdocstrings">

<div class="doc doc-object doc-function">


<a id="dLux.core.Instrument.__init__"></a>
  <div class="doc doc-contents first">
  
      <p>Constructor for the Instrument class.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>optics</code></td>
          <td>
                <code><span title="dLux.core.Optics">Optics</span></code>
          </td>
          <td><p>A pre-configured Optics object.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>sources</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[list, <span title="dLux.core.Source">Source</span>]</code>
          </td>
          <td><p>Either a list of sources or an individual Source object.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>detector</code></td>
          <td>
                <code><span title="dLux.core.Detector">Detector</span></code>
          </td>
          <td><p>A pre-configured Detector object.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>observation</code></td>
          <td>
                <code><span title="dLux.core.Observation">Observation</span></code>
          </td>
          <td><p>An class that inherits from Observation. This is to allow
flexibility in the different kind of observations, ie applying
dithers, switching filters, etc.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>dLux/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span>        <span class="p">:</span> <span class="n">Instrument</span><span class="p">,</span>
             <span class="n">optics</span>      <span class="p">:</span> <span class="n">Optics</span><span class="p">,</span>
             <span class="n">sources</span>     <span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">Source</span><span class="p">],</span>
             <span class="n">detector</span>    <span class="p">:</span> <span class="n">Detector</span>    <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">observation</span> <span class="p">:</span> <span class="n">Observation</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Instrument</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constructor for the Instrument class.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    optics : Optics</span>
<span class="sd">        A pre-configured Optics object.</span>
<span class="sd">    sources : Union[list, Source]</span>
<span class="sd">        Either a list of sources or an individual Source object.</span>
<span class="sd">    detector : Detector = None</span>
<span class="sd">        A pre-configured Detector object.</span>
<span class="sd">    observation : Observation = None</span>
<span class="sd">        An class that inherits from Observation. This is to allow</span>
<span class="sd">        flexibility in the different kind of observations, ie applying</span>
<span class="sd">        dithers, switching filters, etc.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Optics</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">optics</span><span class="p">,</span> <span class="n">Optics</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;optics must be an Optics object.&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">optics</span> <span class="o">=</span> <span class="n">optics</span>

    <span class="c1"># Sources</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sources</span><span class="p">,</span> <span class="n">Source</span><span class="p">()):</span>
        <span class="n">sources</span> <span class="o">=</span> <span class="p">[</span><span class="n">sources</span><span class="p">]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sources</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">sources</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">Source</span><span class="p">()):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;sources must be a list of Source objects.&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sources</span> <span class="o">=</span> <span class="n">dLux</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">list_to_dictionary</span><span class="p">(</span><span class="n">sources</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Detector</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">detector</span><span class="p">,</span> <span class="p">(</span><span class="n">Detector</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">))):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;detector must be an Detector object. &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Got type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">detector</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">detector</span> <span class="o">=</span> <span class="n">detector</span>

    <span class="c1"># Observation</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">observation</span><span class="p">,</span> <span class="p">(</span><span class="n">Observation</span><span class="p">(),</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">))):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;observation must be an Observation object.&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">observation</span> <span class="o">=</span> <span class="n">observation</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div><h2 data-role="function" id="dLux.core.Instrument.__init__"><a class="headerlink" href="#dLux.core.Instrument.__init__" title="Permanent link">¤</a></h2>
</div>
</details>
<div class="admonition tip">
<p class="admonition-title">Accessing Parameters</p>
<p>The Instrument class is set up with a <code>__getattr__</code> method that is able to raise parameters from the <code>optics</code>, <code>detector</code>, <code>sources</code> and <code>observation</code> classes if they are present. Say we have a Instrument with an <code>Optics</code> class that applies optical aberrations via a layer called <code>Aberrations</code> set via its name parameter. We would normally need to use the following path to access the <code>name</code> parameter:</p>
<div class="highlight"><pre><span></span><code><span class="n">aberration_layer</span> <span class="o">=</span> <span class="n">instrument</span><span class="o">.</span><span class="n">optics</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="s1">&#39;Aberrations&#39;</span><span class="p">]</span>
</code></pre></div>
<p>Which is quite long. Since all instrument classes have an optics class and all optics classes have a layers attribute, we can instead use the following:</p>
<div class="highlight"><pre><span></span><code><span class="n">aberration_layer</span> <span class="o">=</span> <span class="n">instrument</span><span class="o">.</span><span class="n">Aberrations</span>
</code></pre></div>
<p>Which is much simpler! Dont forget to set the name parameter of layers you will need to access often!</p>
</div>
<details class="info">
<summary>model API</summary>
<div class="mkdocstrings">

<div class="doc doc-object doc-function">


<a id="dLux.core.Instrument.model"></a>
  <div class="doc doc-contents first">
  
      <p>A base level modelling function designed to robustly handle the
different combinations of inputs. Models the sources through the
instrument optics and detector.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>normalise_sources</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to normalise the sources before modelling.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>flatten</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether the output image should be flattened.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>return_tree</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to return a Pytree like object with matching tree structure
as the input sources (ie dict).</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>image</code></td>          <td>
                <code><span title="dLux.core.Array">Array</span>, dict</code>
          </td>
          <td><p>The image of the scene modelled through the optics with detector and
filter effects applied if they are supplied. Returns either as a
single array (if return_tree is false), or a dict of the output for
each source.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>dLux/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">model</span><span class="p">(</span><span class="bp">self</span>              <span class="p">:</span> <span class="n">Instrument</span><span class="p">,</span>
          <span class="n">normalise_sources</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
          <span class="n">flatten</span>           <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
          <span class="n">return_tree</span>       <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A base level modelling function designed to robustly handle the</span>
<span class="sd">    different combinations of inputs. Models the sources through the</span>
<span class="sd">    instrument optics and detector.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    normalise_sources : bool = True</span>
<span class="sd">        Whether to normalise the sources before modelling.</span>
<span class="sd">    flatten : bool = False</span>
<span class="sd">        Whether the output image should be flattened.</span>
<span class="sd">    return_tree : bool = False</span>
<span class="sd">        Whether to return a Pytree like object with matching tree structure</span>
<span class="sd">        as the input sources (ie dict).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    image : Array, dict</span>
<span class="sd">        The image of the scene modelled through the optics with detector and</span>
<span class="sd">        filter effects applied if they are supplied. Returns either as a</span>
<span class="sd">        single array (if return_tree is false), or a dict of the output for</span>
<span class="sd">        each source.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optics</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">detector</span><span class="p">,</span> 
        <span class="n">normalise_sources</span><span class="p">,</span> <span class="n">flatten</span><span class="p">,</span> <span class="n">return_tree</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div><h2 data-role="function" id="dLux.core.Instrument.model"><a class="headerlink" href="#dLux.core.Instrument.model" title="Permanent link">¤</a></h2>
</div>
</details>
<details class="info">
<summary>observe API</summary>
<div class="mkdocstrings">

<div class="doc doc-object doc-function">


<a id="dLux.core.Instrument.observe"></a>
  <div class="doc doc-contents first">
  
      <p>Calls the <code>observe</code> method of the stored observation class, passing in
any extra keyword arguments.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code> </code>
          </td>
          <td><p>The output of the stored observation class.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>dLux/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">observe</span><span class="p">(</span><span class="bp">self</span> <span class="p">:</span> <span class="n">Instrument</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calls the `observe` method of the stored observation class, passing in</span>
<span class="sd">    any extra keyword arguments.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">     : Any</span>
<span class="sd">        The output of the stored observation class.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">observation</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div><h2 data-role="function" id="dLux.core.Instrument.observe"><a class="headerlink" href="#dLux.core.Instrument.observe" title="Permanent link">¤</a></h2>
</div>
</details>
<!-- ??? info "Instrument API"
    :::dLux.core.Instrument -->

<hr />
<h2 id="detector">Detector<a class="headerlink" href="#detector" title="Permanent link">¤</a></h2>
<p>The <code>Detector</code> class is a high level class that is designed to control the transformation applied by a detector. It has only a single attribute, <code>layers</code> which is stored as an ordered dictionary, but input as a list.</p>
<div class="admonition tip">
<p class="admonition-title">Construction</p>
<p>The <code>Detector</code> class only has a single input, <code>layers</code>. This is a list of <code>Layer</code> classes that will be applied to the psf in the order they are given. The layers input is taken as a list and automatically converted to an ordered dictionary, populating the dictionary with the <code>name</code> parameter of each layer as the key. If there are mulitple layers with the same name parameter, the names will be modified to "original_name_0", "original_name_1" etc.</p>
<p>Here is how we would create a basic detector class:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">dLux</span> <span class="k">as</span> <span class="nn">dl</span>

<span class="n">jitter</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="c1"># Pixels</span>
<span class="n">saturation</span> <span class="o">=</span> <span class="mf">1e5</span> <span class="c1"># ADU</span>

<span class="n">layers</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">dl</span><span class="o">.</span><span class="n">ApplyJitter</span><span class="p">(</span><span class="n">jitter</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Jitter&#39;</span><span class="p">),</span>
    <span class="n">dl</span><span class="o">.</span><span class="n">ApplySaturation</span><span class="p">(</span><span class="n">saturation</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Saturation&#39;</span><span class="p">),</span>
    <span class="p">]</span>

<span class="n">detector</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">Detector</span><span class="p">(</span><span class="n">layers</span><span class="p">)</span>
</code></pre></div>
</div>
<details class="info">
<summary>Constructor API</summary>
<div class="mkdocstrings">

<div class="doc doc-object doc-function">


<a id="dLux.core.Detector.__init__"></a>
  <div class="doc doc-contents first">
  
      <p>Constructor for the Detector class.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>layers</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>An list of dLux detector layer classes that define the instrumental
effects for some detector.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>dLux/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span> <span class="p">:</span> <span class="n">Detector</span><span class="p">,</span> <span class="n">layers</span> <span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Instrument</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constructor for the Detector class.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    layers : list</span>
<span class="sd">        An list of dLux detector layer classes that define the instrumental</span>
<span class="sd">        effects for some detector.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Ensure input is a list</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">layers</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;Input layers must be a list, it is&quot;</span> \
    <span class="s2">&quot; automatically converted to a dictionary.&quot;</span><span class="p">)</span>

    <span class="c1"># Ensure all entries are dLux layers</span>
    <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">dLux</span><span class="o">.</span><span class="n">detectors</span><span class="o">.</span><span class="n">DetectorLayer</span><span class="p">),</span> \
        <span class="p">(</span><span class="s2">&quot;All entries within layers must be a &quot;</span>
         <span class="s2">&quot;dLux.detectors.DetectorLayer object.&quot;</span><span class="p">)</span>

    <span class="c1"># Construct layers</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="n">dLux</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">list_to_dictionary</span><span class="p">(</span><span class="n">layers</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div><h2 data-role="function" id="dLux.core.Detector.__init__"><a class="headerlink" href="#dLux.core.Detector.__init__" title="Permanent link">¤</a></h2>
</div>
</details>
<div class="admonition tip">
<p class="admonition-title">Accessing Parameters</p>
<p>The Detector class is set up with a <code>__getattr__</code> method that is able to raise parameters from the <code>layers</code> attribute such that they can be accessed as class parameters via their name. Taking the example from above, we can access <code>Jitter</code> layer via:</p>
<div class="highlight"><pre><span></span><code><span class="n">jitter_layer</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="n">Jitter</span>
</code></pre></div>
<p>Without the <code>__getattr__</code> method we would have to use the following path to access the 'Jitter' layer:</p>
<div class="highlight"><pre><span></span><code><span class="n">jitter_layer</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="s1">&#39;Jitter&#39;</span><span class="p">]</span>
</code></pre></div>
<p>Which is a lot less nice!</p>
</div>
<p>The <code>Detector</code> has a simple API with two primary methods: <code>model</code> and <code>apply_detector</code>. The <code>model</code> method takes in an Optics object and source or list of sources, propagates them through the layers of the optics class and then applies the detector layers. The <code>apply_detector</code> method simply applies the detector layers to a given input array.</p>
<details class="info">
<summary>model API</summary>
<div class="mkdocstrings">

<div class="doc doc-object doc-function">


<a id="dLux.core.Detector.model"></a>
  <div class="doc doc-contents first">
  
      <p>A function to apply the detector layers to the input image.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>image</code></td>
          <td>
                <code><span title="dLux.core.Array">Array</span></code>
          </td>
          <td><p>The image to be transformed by the detector layers.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>image</code></td>          <td>
                <code><span title="dLux.core.Array">Array</span></code>
          </td>
          <td><p>The image after being transformed by the detector layers.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>dLux/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">model</span><span class="p">(</span><span class="bp">self</span> <span class="p">:</span> <span class="n">Detector</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A function to apply the detector layers to the input image.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    image: Array</span>
<span class="sd">        The image to be transformed by the detector layers.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    image : Array</span>
<span class="sd">        The image after being transformed by the detector layers.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_detector</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div><h2 data-role="function" id="dLux.core.Detector.model"><a class="headerlink" href="#dLux.core.Detector.model" title="Permanent link">¤</a></h2>
</div>
</details>
<details class="info">
<summary>apply_detector API</summary>
<div class="mkdocstrings">

<div class="doc doc-object doc-function">


<a id="dLux.core.Detector.apply_detector"></a>
  <div class="doc doc-contents first">
  
      <p>Applied the stored detector layers to the input image.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>image</code></td>
          <td>
                <code><span title="dLux.core.Array">Array</span></code>
          </td>
          <td><p>The input 'image' to the detector to be transformed.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>image</code></td>          <td>
                <code><span title="dLux.core.Array">Array</span></code>
          </td>
          <td><p>The ouput 'image' after being transformed by the detector layers.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>dLux/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">apply_detector</span><span class="p">(</span><span class="bp">self</span> <span class="p">:</span> <span class="n">Instrument</span><span class="p">,</span> <span class="n">image</span> <span class="p">:</span> <span class="n">Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Applied the stored detector layers to the input image.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    image : Array</span>
<span class="sd">        The input &#39;image&#39; to the detector to be transformed.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    image : Array</span>
<span class="sd">        The ouput &#39;image&#39; after being transformed by the detector layers.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Input type checking</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">),</span> <span class="s2">&quot;Input must be a jax array.&quot;</span>
    <span class="k">assert</span> <span class="n">image</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Input image must a 2d array.&quot;</span>

    <span class="c1"># Apply detector layers</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">image</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div><h2 data-role="function" id="dLux.core.Detector.apply_detector"><a class="headerlink" href="#dLux.core.Detector.apply_detector" title="Permanent link">¤</a></h2>
</div>
</details>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.expand", "navigation.path", "navigation.indexes", "navigation.top", "content.code.copy", "toc.integrate"], "search": "../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.51198bba.min.js"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>